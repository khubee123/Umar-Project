<!doctype html>
<html lang="en" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>School Management System</title>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="/_sdk/data_sdk.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700;800;900&amp;family=Poppins:wght@300;400;500;600;700&amp;family=Satisfy&amp;family=Great+Vibes&amp;display=swap" rel="stylesheet">
  <style>
    body {
      box-sizing: border-box;
    }
    .cert-decorative-font {
      font-family: 'Playfair Display', serif;
    }
    .cert-signature-font {
      font-family: 'Great Vibes', cursive;
    }
    .cert-title-font {
      font-family: 'Satisfy', cursive;
    }
    .modern-font {
      font-family: 'Poppins', sans-serif;
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
 </head>
 <body class="h-full">
  <div id="app" class="w-full h-full overflow-auto" style="background: linear-gradient(135deg, #FF6B6B 0%, #FFA500 25%, #4ECDC4 50%, #45B7D1 75%, #96CEB4 100%);"><!-- Login Screen -->
   <div id="loginScreen" class="min-h-full flex items-center justify-center p-6">
    <div class="bg-white rounded-2xl shadow-xl p-8 w-full max-w-md" style="border: 4px solid; border-image: linear-gradient(135deg, #FF6B6B, #FFA500, #4ECDC4, #45B7D1) 1;">
     <h1 id="loginHeader" class="text-3xl font-bold text-center mb-2" style="background: linear-gradient(135deg, #FF6B6B, #FFA500, #4ECDC4); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">Welcome Back</h1>
     <p class="text-center text-gray-600 mb-6">Sign in to access the system</p>
     <form id="loginForm" class="space-y-4">
      <div><label for="loginUsername" class="block text-sm font-medium text-gray-700 mb-1">Username</label> <input type="text" id="loginUsername" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
      </div>
      <div><label for="loginPassword" class="block text-sm font-medium text-gray-700 mb-1">Password</label> <input type="password" id="loginPassword" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
      </div>
      <div id="loginError" class="hidden text-red-600 text-sm"></div><button type="submit" class="w-full text-white py-2 rounded-lg transition-all font-medium shadow-lg hover:shadow-xl transform hover:scale-105" style="background: linear-gradient(135deg, #FF6B6B, #FFA500, #4ECDC4);"> Sign In </button>
     </form>
     <div class="mt-6 text-center"><button id="showRegisterBtn" class="text-blue-600 hover:text-blue-700 text-sm font-medium"> Need an account? Register here </button>
     </div>
    </div>
   </div><!-- Registration Screen -->
   <div id="registerScreen" class="hidden min-h-full flex items-center justify-center p-6">
    <div class="bg-white rounded-2xl shadow-xl p-8 w-full max-w-md" style="border: 4px solid; border-image: linear-gradient(135deg, #4ECDC4, #45B7D1, #96CEB4, #FFA500) 1;">
     <h1 id="registrationHeader" class="text-3xl font-bold text-center mb-2" style="background: linear-gradient(135deg, #4ECDC4, #45B7D1, #96CEB4); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">Create Account</h1>
     <p class="text-center text-gray-600 mb-6">Register for system access</p>
     <form id="registerForm" class="space-y-4">
      <div><label for="regFullName" class="block text-sm font-medium text-gray-700 mb-1">Full Name</label> <input type="text" id="regFullName" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
      </div>
      <div><label for="regUsername" class="block text-sm font-medium text-gray-700 mb-1">Username</label> <input type="text" id="regUsername" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
      </div>
      <div><label for="regPassword" class="block text-sm font-medium text-gray-700 mb-1">Password</label> <input type="password" id="regPassword" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
      </div>
      <div><label for="regPhone" class="block text-sm font-medium text-gray-700 mb-1">Phone Number</label> <input type="tel" id="regPhone" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
      </div>
      <div><label for="regEmail" class="block text-sm font-medium text-gray-700 mb-1">Email</label> <input type="email" id="regEmail" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
      </div>
      <div><label for="regAddress" class="block text-sm font-medium text-gray-700 mb-1">Address</label> <input type="text" id="regAddress" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
      </div>
      <div><label for="regRole" class="block text-sm font-medium text-gray-700 mb-1">Role</label> <select id="regRole" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"> <option value="">Select Role</option> <option value="teacher">Teacher</option> <option value="staff">Staff</option> <option value="admin">Admin</option> <option value="committee">Committee Member</option> </select>
      </div>
      <div id="registerMessage" class="hidden text-sm"></div><button type="submit" class="w-full text-white py-2 rounded-lg transition-all font-medium shadow-lg hover:shadow-xl transform hover:scale-105" style="background: linear-gradient(135deg, #4ECDC4, #45B7D1, #96CEB4);"> Register </button>
     </form>
     <div class="mt-6 text-center"><button id="showLoginBtn" class="text-blue-600 hover:text-blue-700 text-sm font-medium"> Already have an account? Sign in </button>
     </div>
    </div>
   </div><!-- Main Application -->
   <div id="mainApp" class="hidden w-full h-full flex flex-col"><!-- Header -->
    <header class="shadow-sm border-b-4" style="background: linear-gradient(90deg, #FF6B6B 0%, #FFA500 25%, #4ECDC4 50%, #45B7D1 75%, #96CEB4 100%); border-image: linear-gradient(90deg, #FF6B6B, #FFA500, #4ECDC4) 1;">
     <div class="px-6 py-3">
      <div class="flex items-center justify-between mb-2">
       <div>
        <h1 id="appTitle" class="text-2xl font-bold text-white drop-shadow-lg">Madrasa Academy Management System</h1>
        <p class="text-xs text-white opacity-90">Developed By: Umar Ahmed, Hirna Oromia</p>
       </div><button id="logoutBtn" class="bg-white text-transparent px-4 py-2 rounded-lg transition-all font-medium shadow-md hover:shadow-lg transform hover:scale-105" style="background: white; background-clip: padding-box; color: #FF6B6B; border: 2px solid #FF6B6B;"> Logout </button>
      </div>
     </div>
    </header><!-- Navigation -->
    <nav class="bg-white border-b-4 px-6 py-3 overflow-x-auto shadow-md" style="border-image: linear-gradient(90deg, #FF6B6B, #FFA500, #4ECDC4, #45B7D1, #96CEB4) 1;">
     <div class="flex space-x-2"><button data-view="attendance" class="nav-btn px-4 py-2 rounded-lg font-medium text-sm whitespace-nowrap text-white shadow-md" style="background: linear-gradient(135deg, #FF6B6B, #FFA500);">Attendance</button> <button data-view="missedPeriods" class="nav-btn px-4 py-2 rounded-lg font-medium text-sm whitespace-nowrap text-gray-600 hover:bg-gradient-to-r hover:from-yellow-100 hover:to-orange-100 transition-all">Missed Periods</button> <button data-view="compensated" class="nav-btn px-4 py-2 rounded-lg font-medium text-sm whitespace-nowrap text-gray-600 hover:bg-gradient-to-r hover:from-green-100 hover:to-teal-100 transition-all">Compensated</button> <button data-view="familyMeeting" class="nav-btn px-4 py-2 rounded-lg font-medium text-sm whitespace-nowrap text-gray-600 hover:bg-gradient-to-r hover:from-blue-100 hover:to-cyan-100 transition-all">Family Meeting</button> <button data-view="studentRally" class="nav-btn px-4 py-2 rounded-lg font-medium text-sm whitespace-nowrap text-gray-600 hover:bg-gradient-to-r hover:from-purple-100 hover:to-pink-100 transition-all">Student Rally</button> <button data-view="certificates" class="nav-btn px-4 py-2 rounded-lg font-medium text-sm whitespace-nowrap text-gray-600 hover:bg-gradient-to-r hover:from-indigo-100 hover:to-purple-100 transition-all">Certificates</button> <button data-view="committeeReg" class="nav-btn px-4 py-2 rounded-lg font-medium text-sm whitespace-nowrap text-gray-600 hover:bg-gradient-to-r hover:from-pink-100 hover:to-rose-100 transition-all">Committee Reg</button> <button data-view="staffReg" class="nav-btn px-4 py-2 rounded-lg font-medium text-sm whitespace-nowrap text-gray-600 hover:bg-gradient-to-r hover:from-amber-100 hover:to-yellow-100 transition-all">Staff Reg</button> <button data-view="reportCards" class="nav-btn px-4 py-2 rounded-lg font-medium text-sm whitespace-nowrap text-gray-600 hover:bg-gradient-to-r hover:from-lime-100 hover:to-green-100 transition-all">Report Cards</button> <button data-view="roster" class="nav-btn px-4 py-2 rounded-lg font-medium text-sm whitespace-nowrap text-gray-600 hover:bg-gradient-to-r hover:from-cyan-100 hover:to-blue-100 transition-all">Roster</button> <button data-view="sectorsEvents" class="nav-btn px-4 py-2 rounded-lg font-medium text-sm whitespace-nowrap text-gray-600 hover:bg-gradient-to-r hover:from-violet-100 hover:to-purple-100 transition-all">Sectors Events</button> <button data-view="teachersReg" class="nav-btn admin-only px-4 py-2 rounded-lg font-medium text-sm whitespace-nowrap text-gray-600 hover:bg-gradient-to-r hover:from-red-100 hover:to-orange-100 transition-all" style="display:none;">Teachers Reg</button> <button data-view="adminDashboard" class="nav-btn admin-only px-4 py-2 rounded-lg font-medium text-sm whitespace-nowrap text-gray-600 hover:bg-gradient-to-r hover:from-fuchsia-100 hover:to-pink-100 transition-all" style="display:none;">Admin Dashboard</button>
     </div>
    </nav><!-- Content Area -->
    <main class="flex-1 overflow-auto p-6"><!-- Attendance View -->
     <div id="attendanceView" class="view-content">
      <div class="bg-white rounded-xl shadow-2xl p-8 max-w-4xl mx-auto" style="border-top: 8px solid; border-image: linear-gradient(90deg, #FF6B6B, #FFA500, #4ECDC4) 1;">
       <div class="text-center mb-8">
        <div class="text-5xl mb-3">
         üìã
        </div>
        <h2 class="text-3xl font-bold mb-2" style="background: linear-gradient(135deg, #FF6B6B, #FFA500); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">Daily Attendance</h2>
        <p class="text-gray-600">Record attendance for teachers, staff, students, committee members, and parents</p>
       </div>
       <form id="attendanceForm" class="space-y-5">
        <div><label for="personType" class="block text-sm font-medium text-gray-700 mb-1">Person Type</label> <select id="personType" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"> <option value="">Select Type</option> <option value="teacher">Teacher</option> <option value="staff">Staff</option> <option value="student">Student</option> <option value="committee">Committee</option> <option value="parent">Parent</option> </select>
        </div>
        <div><label for="attName" class="block text-sm font-medium text-gray-700 mb-1">Name</label> <input type="text" id="attName" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
        </div>
        <div><label for="attDate" class="block text-sm font-medium text-gray-700 mb-1">Date</label> <input type="date" id="attDate" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
        </div>
        <div><label for="timeIn" class="block text-sm font-medium text-gray-700 mb-1">Time In</label> <input type="time" id="timeIn" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
        </div>
        <div><label for="timeOut" class="block text-sm font-medium text-gray-700 mb-1">Time Out (Optional)</label> <input type="time" id="timeOut" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
        </div>
        <div><label for="attStatus" class="block text-sm font-medium text-gray-700 mb-1">Status</label> <select id="attStatus" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"> <option value="">Select Status</option> <option value="present">Present</option> <option value="absent">Absent</option> <option value="late">Late</option> <option value="excused">Excused</option> </select>
        </div>
        <div><label for="attNotes" class="block text-sm font-medium text-gray-700 mb-1">Notes (Optional)</label> <textarea id="attNotes" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"></textarea>
        </div>
        <div id="attMessage" class="hidden text-sm"></div>
        <div class="flex space-x-4"><button type="submit" class="flex-1 text-white py-3 rounded-lg transition-all font-medium shadow-lg hover:shadow-xl transform hover:scale-105" style="background: linear-gradient(135deg, #FF6B6B, #FFA500);"> üíæ Save Attendance </button> <button type="button" onclick="exportAttendanceToExcel()" class="bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition-all font-medium shadow-lg hover:shadow-xl transform hover:scale-105"> üìä Export to Excel </button>
        </div>
       </form>
      </div>
     </div><!-- Missed Periods View -->
     <div id="missedPeriodsView" class="view-content hidden">
      <div class="bg-white rounded-xl shadow-2xl p-8 max-w-5xl mx-auto" style="border-top: 8px solid; border-image: linear-gradient(90deg, #FF6B6B, #FFA500, #4ECDC4) 1;">
       <div class="text-center mb-8">
        <div class="text-5xl mb-3">
         üìö
        </div>
        <h2 class="text-3xl font-bold mb-2" style="background: linear-gradient(135deg, #FF6B6B, #FFA500, #4ECDC4); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">Missed Teaching Periods</h2>
        <p class="text-gray-600">Track and record missed teaching periods with detailed information</p>
       </div>
       <form id="sectorsForm" class="space-y-6">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
         <div><label for="sectorsRowNum" class="block text-sm font-medium text-gray-700 mb-1">Row Number</label> <input type="number" id="sectorsRowNum" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
         </div>
         <div><label for="sectorsTeacher" class="block text-sm font-medium text-gray-700 mb-1">Teacher Name</label> <input type="text" id="sectorsTeacher" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
         </div>
        </div>
        <div><label for="sectorsDay" class="block text-sm font-medium text-gray-700 mb-1">Day</label> <input type="date" id="sectorsDay" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
        </div>
        <div class="border-t pt-4 mt-4">
         <h3 class="font-semibold text-gray-700 mb-3">Periods Missed</h3>
         <div class="space-y-3">
          <div class="border rounded-lg p-3">
           <div class="flex items-center mb-2"><input type="checkbox" id="period1Missed" class="period-checkbox mr-2"> <label for="period1Missed" class="font-medium text-gray-700">Period 1</label>
           </div>
           <div id="period1Details" class="hidden ml-6 space-y-2"><input type="text" id="period1Subject" placeholder="Subject" class="w-full px-3 py-1 border border-gray-300 rounded text-sm"> <input type="text" id="period1Grade" placeholder="Grade" class="w-full px-3 py-1 border border-gray-300 rounded text-sm"> <input type="number" id="period1Minutes" placeholder="Minutes" class="w-full px-3 py-1 border border-gray-300 rounded text-sm">
           </div>
          </div>
          <div class="border rounded-lg p-3">
           <div class="flex items-center mb-2"><input type="checkbox" id="period2Missed" class="period-checkbox mr-2"> <label for="period2Missed" class="font-medium text-gray-700">Period 2</label>
           </div>
           <div id="period2Details" class="hidden ml-6 space-y-2"><input type="text" id="period2Subject" placeholder="Subject" class="w-full px-3 py-1 border border-gray-300 rounded text-sm"> <input type="text" id="period2Grade" placeholder="Grade" class="w-full px-3 py-1 border border-gray-300 rounded text-sm"> <input type="number" id="period2Minutes" placeholder="Minutes" class="w-full px-3 py-1 border border-gray-300 rounded text-sm">
           </div>
          </div>
          <div class="border rounded-lg p-3">
           <div class="flex items-center mb-2"><input type="checkbox" id="period3Missed" class="period-checkbox mr-2"> <label for="period3Missed" class="font-medium text-gray-700">Period 3</label>
           </div>
           <div id="period3Details" class="hidden ml-6 space-y-2"><input type="text" id="period3Subject" placeholder="Subject" class="w-full px-3 py-1 border border-gray-300 rounded text-sm"> <input type="text" id="period3Grade" placeholder="Grade" class="w-full px-3 py-1 border border-gray-300 rounded text-sm"> <input type="number" id="period3Minutes" placeholder="Minutes" class="w-full px-3 py-1 border border-gray-300 rounded text-sm">
           </div>
          </div>
          <div class="border rounded-lg p-3">
           <div class="flex items-center mb-2"><input type="checkbox" id="period4Missed" class="period-checkbox mr-2"> <label for="period4Missed" class="font-medium text-gray-700">Period 4</label>
           </div>
           <div id="period4Details" class="hidden ml-6 space-y-2"><input type="text" id="period4Subject" placeholder="Subject" class="w-full px-3 py-1 border border-gray-300 rounded text-sm"> <input type="text" id="period4Grade" placeholder="Grade" class="w-full px-3 py-1 border border-gray-300 rounded text-sm"> <input type="number" id="period4Minutes" placeholder="Minutes" class="w-full px-3 py-1 border border-gray-300 rounded text-sm">
           </div>
          </div>
          <div class="border rounded-lg p-3">
           <div class="flex items-center mb-2"><input type="checkbox" id="period5Missed" class="period-checkbox mr-2"> <label for="period5Missed" class="font-medium text-gray-700">Period 5</label>
           </div>
           <div id="period5Details" class="hidden ml-6 space-y-2"><input type="text" id="period5Subject" placeholder="Subject" class="w-full px-3 py-1 border border-gray-300 rounded text-sm"> <input type="text" id="period5Grade" placeholder="Grade" class="w-full px-3 py-1 border border-gray-300 rounded text-sm"> <input type="number" id="period5Minutes" placeholder="Minutes" class="w-full px-3 py-1 border border-gray-300 rounded text-sm">
           </div>
          </div>
          <div class="border rounded-lg p-3">
           <div class="flex items-center mb-2"><input type="checkbox" id="period6Missed" class="period-checkbox mr-2"> <label for="period6Missed" class="font-medium text-gray-700">Period 6</label>
           </div>
           <div id="period6Details" class="hidden ml-6 space-y-2"><input type="text" id="period6Subject" placeholder="Subject" class="w-full px-3 py-1 border border-gray-300 rounded text-sm"> <input type="text" id="period6Grade" placeholder="Grade" class="w-full px-3 py-1 border border-gray-300 rounded text-sm"> <input type="number" id="period6Minutes" placeholder="Minutes" class="w-full px-3 py-1 border border-gray-300 rounded text-sm">
           </div>
          </div>
         </div>
        </div>
        <div><label for="sectorsReason" class="block text-sm font-medium text-gray-700 mb-1">Reason (Optional)</label> <textarea id="sectorsReason" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"></textarea>
        </div>
        <div><label for="sectorsSignature" class="block text-sm font-medium text-gray-700 mb-1">Teacher Signature (Optional)</label> <input type="text" id="sectorsSignature" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
        </div>
        <div id="sectorsMessage" class="hidden text-sm"></div>
        <div class="flex space-x-4"><button type="submit" class="flex-1 text-white py-3 rounded-lg transition-all font-medium shadow-lg hover:shadow-xl transform hover:scale-105" style="background: linear-gradient(135deg, #FF6B6B, #FFA500, #4ECDC4);"> üíæ Save Missed Periods </button> <button type="button" onclick="exportMissedPeriodsToExcel()" class="bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition-all font-medium shadow-lg hover:shadow-xl transform hover:scale-105"> üìä Export to Excel </button>
        </div>
       </form>
      </div>
     </div><!-- Compensated View -->
     <div id="compensatedView" class="view-content hidden">
      <div class="bg-white rounded-xl shadow-2xl p-8 max-w-5xl mx-auto" style="border-top: 8px solid; border-image: linear-gradient(90deg, #96CEB4, #4ECDC4, #45B7D1) 1;">
       <div class="text-center mb-8">
        <div class="text-5xl mb-3">
         ‚úÖ
        </div>
        <h2 class="text-3xl font-bold mb-2" style="background: linear-gradient(135deg, #96CEB4, #4ECDC4, #45B7D1); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">Compensated Periods</h2>
        <p class="text-gray-600">Record periods that have been successfully compensated by teachers</p>
       </div>
       <form id="compensatedForm" class="space-y-6">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
         <div><label for="compRowNum" class="block text-sm font-medium text-gray-700 mb-1">Row Number</label> <input type="number" id="compRowNum" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
         </div>
         <div><label for="compTeacher" class="block text-sm font-medium text-gray-700 mb-1">Teacher Name</label> <input type="text" id="compTeacher" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
         </div>
        </div>
        <div><label for="compDay" class="block text-sm font-medium text-gray-700 mb-1">Day</label> <input type="date" id="compDay" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
        </div>
        <div class="border-t pt-4 mt-4">
         <h3 class="font-semibold text-gray-700 mb-3">Periods Compensated</h3>
         <div class="space-y-3">
          <div class="border rounded-lg p-3">
           <div class="flex items-center mb-2"><input type="checkbox" id="compPeriod1" class="comp-checkbox mr-2"> <label for="compPeriod1" class="font-medium text-gray-700">Period 1</label>
           </div>
           <div id="compPeriod1Details" class="hidden ml-6 space-y-2"><input type="text" id="compPeriod1Subject" placeholder="Subject" class="w-full px-3 py-1 border border-gray-300 rounded text-sm"> <input type="text" id="compPeriod1Grade" placeholder="Grade" class="w-full px-3 py-1 border border-gray-300 rounded text-sm">
           </div>
          </div>
          <div class="border rounded-lg p-3">
           <div class="flex items-center mb-2"><input type="checkbox" id="compPeriod2" class="comp-checkbox mr-2"> <label for="compPeriod2" class="font-medium text-gray-700">Period 2</label>
           </div>
           <div id="compPeriod2Details" class="hidden ml-6 space-y-2"><input type="text" id="compPeriod2Subject" placeholder="Subject" class="w-full px-3 py-1 border border-gray-300 rounded text-sm"> <input type="text" id="compPeriod2Grade" placeholder="Grade" class="w-full px-3 py-1 border border-gray-300 rounded text-sm">
           </div>
          </div>
          <div class="border rounded-lg p-3">
           <div class="flex items-center mb-2"><input type="checkbox" id="compPeriod3" class="comp-checkbox mr-2"> <label for="compPeriod3" class="font-medium text-gray-700">Period 3</label>
           </div>
           <div id="compPeriod3Details" class="hidden ml-6 space-y-2"><input type="text" id="compPeriod3Subject" placeholder="Subject" class="w-full px-3 py-1 border border-gray-300 rounded text-sm"> <input type="text" id="compPeriod3Grade" placeholder="Grade" class="w-full px-3 py-1 border border-gray-300 rounded text-sm">
           </div>
          </div>
          <div class="border rounded-lg p-3">
           <div class="flex items-center mb-2"><input type="checkbox" id="compPeriod4" class="comp-checkbox mr-2"> <label for="compPeriod4" class="font-medium text-gray-700">Period 4</label>
           </div>
           <div id="compPeriod4Details" class="hidden ml-6 space-y-2"><input type="text" id="compPeriod4Subject" placeholder="Subject" class="w-full px-3 py-1 border border-gray-300 rounded text-sm"> <input type="text" id="compPeriod4Grade" placeholder="Grade" class="w-full px-3 py-1 border border-gray-300 rounded text-sm">
           </div>
          </div>
          <div class="border rounded-lg p-3">
           <div class="flex items-center mb-2"><input type="checkbox" id="compPeriod5" class="comp-checkbox mr-2"> <label for="compPeriod5" class="font-medium text-gray-700">Period 5</label>
           </div>
           <div id="compPeriod5Details" class="hidden ml-6 space-y-2"><input type="text" id="compPeriod5Subject" placeholder="Subject" class="w-full px-3 py-1 border border-gray-300 rounded text-sm"> <input type="text" id="compPeriod5Grade" placeholder="Grade" class="w-full px-3 py-1 border border-gray-300 rounded text-sm">
           </div>
          </div>
          <div class="border rounded-lg p-3">
           <div class="flex items-center mb-2"><input type="checkbox" id="compPeriod6" class="comp-checkbox mr-2"> <label for="compPeriod6" class="font-medium text-gray-700">Period 6</label>
           </div>
           <div id="compPeriod6Details" class="hidden ml-6 space-y-2"><input type="text" id="compPeriod6Subject" placeholder="Subject" class="w-full px-3 py-1 border border-gray-300 rounded text-sm"> <input type="text" id="compPeriod6Grade" placeholder="Grade" class="w-full px-3 py-1 border border-gray-300 rounded text-sm">
           </div>
          </div>
         </div>
        </div>
<html>
<head>
    <title>File Manager</title>
    <style>
        *{margin:0;padding:0;box-sizing:border-box;font-family:system-ui}
        body{background:#f5f7fa;padding:20px;color:#333}
        .container{max-width:800px;margin:0 auto;background:#fff;border-radius:10px;box-shadow:0 5px 15px rgba(0,0,0,0.08);padding:25px}
        h1{margin-bottom:10px;color:#2c3e50}
        .subtitle{color:#7f8c8d;margin-bottom:25px}
        .upload-area{background:#f8f9fa;border:3px dashed #3498db;border-radius:10px;padding:40px;text-align:center;margin:25px 0;transition:.3s}
        .upload-area:hover{background:#e8f4fc}
        .upload-area.dragover{background:#d4edda;border-color:#28a745}
        #fileInput{display:none}
        .upload-btn{display:inline-block;background:#3498db;color:#fff;padding:12px 30px;border-radius:6px;cursor:pointer;font-weight:600;transition:.3s}
        .upload-btn:hover{background:#2980b9;transform:translateY(-2px)}
        .file-types{margin:15px 0;font-size:.9em;color:#666}
        .file-list{margin-top:30px}
        .file-item{display:flex;align-items:center;background:#f8f9fa;border-radius:8px;padding:15px;margin-bottom:12px;border-left:4px solid #3498db;transition:.2s}
        .file-item:hover{background:#e9ecef;transform:translateX(5px)}
        .file-icon{width:40px;height:40px;border-radius:6px;display:flex;align-items:center;justify-content:center;margin-right:15px;color:#fff;font-weight:bold}
        .pdf{background:#e74c3c}
        .word{background:#3498db}
        .excel{background:#27ae60}
        .ppt{background:#f39c12}
        .other{background:#95a5a6}
        .file-info{flex-grow:1}
        .file-name{font-weight:600;margin-bottom:3px}
        .file-size{color:#7f8c8d;font-size:.85em}
        .download-btn{background:#2ecc71;color:#fff;border:none;padding:8px 15px;border-radius:4px;cursor:pointer;transition:.3s}
        .download-btn:hover{background:#27ae60}
        .status{text-align:center;padding:10px;margin:15px 0;border-radius:5px;display:none}
        .success{background:#d4edda;color:#155724;border:1px solid #c3e6cb}
        .error{background:#f8d7da;color:#721c24;border:1px solid#f5c6cb}
        .file-count{margin-top:15px;color:#7f8c8d;font-size:.9em}
    </style>
</head>
<body>
    <div class="container">
        <h1>üìÅ File Management System</h1>
        <p class="subtitle">Upload and download PPT, Word, Excel, PDF files</p>
        
        <div class="upload-area" id="uploadArea">
            <input type="file" id="fileInput" multiple accept=".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx">
            <label for="fileInput" class="upload-btn">Choose Files</label>
            <p>or drag and drop files here</p>
            <div class="file-types">Supported: PDF, DOC, DOCX, XLS, XLSX, PPT, PPTX</div>
        </div>
        
        <div id="status" class="status"></div>
        
        <div class="file-list">
            <h3>Uploaded Files</h3>
            <div id="fileList"></div>
            <div class="file-count" id="fileCount">0 files</div>
        </div>
    </div>

    <script>
        const fileInput = document.getElementById('fileInput');
        const uploadArea = document.getElementById('uploadArea');
        const fileList = document.getElementById('fileList');
        const status = document.getElementById('status');
        const fileCount = document.getElementById('fileCount');
        
        // Sample initial files
        const files = [
            {name: "Presentation.ppt", size: 2457600, type: "ppt"},
            {name: "Report.docx", size: 1024000, type: "word"},
            {name: "Data.xlsx", size: 3072000, type: "excel"},
            {name: "Manual.pdf", size: 1536000, type: "pdf"}
        ];
        
        // Render file list
        function renderFiles() {
            fileList.innerHTML = '';
            files.forEach((file, index) => {
                const div = document.createElement('div');
                div.className = 'file-item';
                div.innerHTML = `
                    <div class="file-icon ${file.type}">${getFileExt(file.name)}</div>
                    <div class="file-info">
                        <div class="file-name">${file.name}</div>
                        <div class="file-size">${formatFileSize(file.size)}</div>
                    </div>
                    <button class="download-btn" onclick="downloadFile(${index})">Download</button>
                `;
                fileList.appendChild(div);
            });
            fileCount.textContent = `${files.length} file${files.length !== 1 ? 's' : ''}`;
        }
        
        // Get file extension
        function getFileExt(filename) {
            return filename.split('.').pop().toUpperCase();
        }
        
        // Format file size
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
        
        // Determine file type
        function getFileType(filename) {
            const ext = filename.split('.').pop().toLowerCase();
            if (['pdf'].includes(ext)) return 'pdf';
            if (['doc', 'docx'].includes(ext)) return 'word';
            if (['xls', 'xlsx'].includes(ext)) return 'excel';
            if (['ppt', 'pptx'].includes(ext)) return 'ppt';
            return 'other';
        }
        
        // Download file simulation
        function downloadFile(index) {
            const file = files[index];
            showStatus(`Downloading "${file.name}"...`, 'success');
            
            // Simulate download
            setTimeout(() => {
                const link = document.createElement('a');
                link.href = `data:text/plain;charset=utf-8,${encodeURIComponent('Simulated file content for ' + file.name)}`;
                link.download = file.name;
                link.style.display = 'none';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                showStatus(`"${file.name}" downloaded successfully!`, 'success');
            }, 500);
        }
        
        // Show status message
        function showStatus(message, type) {
            status.textContent = message;
            status.className = `status ${type}`;
            status.style.display = 'block';
            setTimeout(() => { status.style.display = 'none'; }, 3000);
        }
        
        // Handle file selection
        fileInput.addEventListener('change', (e) => {
            handleFiles(e.target.files);
        });
        
        // Drag and drop
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });
        
        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });
        
        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            handleFiles(e.dataTransfer.files);
        });
        
        // Handle uploaded files
        function handleFiles(fileList) {
            const validTypes = ['.pdf', '.doc', '.docx', '.xls', '.xlsx', '.ppt', '.pptx'];
            let uploadedCount = 0;
            
            Array.from(fileList).forEach(file => {
                const fileExt = '.' + file.name.split('.').pop().toLowerCase();
                
                if (validTypes.includes(fileExt)) {
                    files.push({
                        name: file.name,
                        size: file.size,
                        type: getFileType(file.name)
                    });
                    uploadedCount++;
                }
            });
            
            if (uploadedCount > 0) {
                renderFiles();
                showStatus(`Successfully uploaded ${uploadedCount} file${uploadedCount !== 1 ? 's' : ''}`, 'success');
            } else {
                showStatus('No valid files selected. Please upload PDF, Word, Excel, or PPT files.', 'error');
            }
            
            // Reset file input
            fileInput.value = '';
        }
        
        // Initial render
        renderFiles();
    </script>
</body>
</html>
        
        
        <div><label for="compNotes" class="block text-sm font-medium text-gray-700 mb-1">Notes (Optional)</label> <textarea id="compNotes" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"></textarea>
        </div>
        <div><label for="compSignature" class="block text-sm font-medium text-gray-700 mb-1">Teacher Signature (Optional)</label> <input type="text" id="compSignature" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
        </div>
        <div id="compMessage" class="hidden text-sm"></div><button type="submit" class="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition-colors font-medium"> Save Compensated Periods </button>
       </form>
      </div>
     </div><!-- Family,teacher,Staff Meeting View -->
     <div id="familyMeetingView" class="view-content hidden">
      <div class="bg-white rounded-xl shadow-2xl p-8 max-w-4xl mx-auto" style="border-top: 8px solid; border-image: linear-gradient(90deg, #FFA500, #FF6B6B, #96CEB4) 1;">
       <div class="text-center mb-8">
        <div class="text-5xl mb-3">
         üë®‚Äçüë©‚Äçüëß‚Äçüë¶
        </div>
        <h2 class="text-3xl font-bold mb-2" style="background: linear-gradient(135deg, #FFA500, #FF6B6B); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">Family Meeting</h2>
        <p class="text-gray-600">Schedule and record parent-teacher conferences and family meetings</p>
       </div>
       <form id="mariiForm" class="space-y-5">
        <div><label for="mariiRowNum" class="block text-sm font-medium text-gray-700 mb-1">Row Number</label> <input type="number" id="mariiRowNum" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
        </div>
        <div><label for="mariiStudent" class="block text-sm font-medium text-gray-700 mb-1">Student Name</label> <input type="text" id="mariiStudent" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
        </div>
        <div><label for="mariiGrade" class="block text-sm font-medium text-gray-700 mb-1">Grade</label> <input type="text" id="mariiGrade" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
        </div>
        <div><label for="mariiParent" class="block text-sm font-medium text-gray-700 mb-1">Parent/Guardian Name</label> <input type="text" id="mariiParent" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
        </div>
        <div><label for="mariiPhone" class="block text-sm font-medium text-gray-700 mb-1">Phone Number (Optional)</label> <input type="tel" id="mariiPhone" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
        </div>
        <div><label for="mariiDate" class="block text-sm font-medium text-gray-700 mb-1">Meeting Date</label> <input type="date" id="mariiDate" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
        </div>
        <div><label for="mariiTime" class="block text-sm font-medium text-gray-700 mb-1">Meeting Time (Optional)</label> <input type="time" id="mariiTime" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
        </div>
        <div><label for="mariiAttendance" class="block text-sm font-medium text-gray-700 mb-1">Attendance Status</label> <select id="mariiAttendance" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"> <option value="">Select Status</option> <option value="present">Present</option> <option value="absent">Absent</option> <option value="excused">Excused</option> </select>
        </div>
        <div><label for="mariiTopic" class="block text-sm font-medium text-gray-700 mb-1">Meeting Topic (Optional)</label> <input type="text" id="mariiTopic" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
        </div>
        <div><label for="mariiNotes" class="block text-sm font-medium text-gray-700 mb-1">Meeting Notes (Optional)</label> <textarea id="mariiNotes" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"></textarea>
        </div>
        <div><label for="mariiSignature" class="block text-sm font-medium text-gray-700 mb-1">Signature (Optional)</label> <input type="text" id="mariiSignature" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
        </div>
        <div id="mariiMessage" class="hidden text-sm"></div><button type="submit" class="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition-colors font-medium"> Save Family Meeting </button>
       </form>
      </div>
     </div><!-- Student Rally View -->
     <div id="studentRallyView" class="view-content hidden">
      <div class="bg-white rounded-xl shadow-2xl p-8 max-w-4xl mx-auto" style="border-top: 8px solid; border-image: linear-gradient(90deg, #45B7D1, #4ECDC4, #96CEB4) 1;">
       <div class="text-center mb-8">
        <div class="text-5xl mb-3">
         üéØ
        </div>
        <h2 class="text-3xl font-bold mb-2" style="background: linear-gradient(135deg, #45B7D1, #4ECDC4); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">Student Rally Checklist</h2>
        <p class="text-gray-600">Monitor teacher compliance and rally participation</p>
       </div>
       <form id="rallyForm" class="space-y-6">
        <div><label for="rallyRowNum" class="block text-sm font-medium text-gray-700 mb-1">Row Number</label> <input type="number" id="rallyRowNum" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
        </div>
        <div><label for="rallyTeacher" class="block text-sm font-medium text-gray-700 mb-1">Teacher Name</label> <input type="text" id="rallyTeacher" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
        </div>
        <div><label for="rallyDate" class="block text-sm font-medium text-gray-700 mb-1">Date</label> <input type="date" id="rallyDate" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
        </div>
        <div class="border-t pt-4 mt-4">
         <h3 class="font-semibold text-gray-700 mb-3">Issues Checklist</h3>
         <div class="space-y-2">
          <div class="flex items-center"><input type="checkbox" id="issue1" class="mr-2"> <label for="issue1" class="text-gray-700">Did not attend the Rally</label>
          </div>
          <div class="flex items-center"><input type="checkbox" id="issue2" class="mr-2"> <label for="issue2" class="text-gray-700">Teacher Gown not worn</label>
          </div>
          <div class="flex items-center"><input type="checkbox" id="issue3" class="mr-2"> <label for="issue3" class="text-gray-700">Student Protection issue</label>
          </div>
          <div class="flex items-center"><input type="checkbox" id="issue4" class="mr-2"> <label for="issue4" class="text-gray-700">School Discipline Violated</label>
          </div>
          <div class="flex items-center"><input type="checkbox" id="issue5" class="mr-2"> <label for="issue5" class="text-gray-700">Circle not participated</label>
          </div>
          <div class="flex items-center"><input type="checkbox" id="issue6" class="mr-2"> <label for="issue6" class="text-gray-700">Garden not taken care of</label>
          </div>
          <div class="flex items-center"><input type="checkbox" id="issue7" class="mr-2"> <label for="issue7" class="text-gray-700">Weekly plan not entered</label>
          </div>
          <div class="flex items-center"><input type="checkbox" id="issue8" class="mr-2"> <label for="issue8" class="text-gray-700">Monthly plan not entered</label>
          </div>
          <div class="flex items-center"><input type="checkbox" id="issue9" class="mr-2"> <label for="issue9" class="text-gray-700">Assembly not conducted</label>
          </div>
          <div class="flex items-center"><input type="checkbox" id="issue10" class="mr-2"> <label for="issue10" class="text-gray-700">Yearly department plan not entered</label>
          </div>
          <div class="flex items-center"><input type="checkbox" id="issue11" class="mr-2"> <label for="issue11" class="text-gray-700">Student grade improvement not entered</label>
          </div>
         </div>
        </div>
        <div><label for="rallyNotes" class="block text-sm font-medium text-gray-700 mb-1">Additional Notes (Optional)</label> <textarea id="rallyNotes" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"></textarea>
        </div>
        <div><label for="rallySignature" class="block text-sm font-medium text-gray-700 mb-1">Supervisor Signature (Optional)</label> <input type="text" id="rallySignature" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
        </div>
        <div id="rallyMessage" class="hidden text-sm"></div>
        <div class="flex space-x-4"><button type="submit" class="flex-1 text-white py-3 rounded-lg transition-all font-medium shadow-lg hover:shadow-xl transform hover:scale-105" style="background: linear-gradient(135deg, #45B7D1, #4ECDC4);"> üíæ Save Rally Record </button> <button type="button" onclick="exportRallyToExcel()" class="bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition-all font-medium shadow-lg hover:shadow-xl transform hover:scale-105"> üìä Export to Excel </button>
        </div>
       </form><!-- Saved Rally Records -->
       <div class="mt-8 p-6 bg-gradient-to-br from-blue-50 to-cyan-50 rounded-xl border-2 border-blue-200">
        <h3 class="text-xl font-bold text-gray-800 mb-4">üìã Recent Rally Records</h3>
        <div id="savedRallyRecords" class="space-y-3">
         <p class="text-gray-500 text-sm">No rally records saved yet</p>
        </div>
       </div>
      </div>
     </div><!-- Certificates View -->
     <div id="certificatesView" class="view-content hidden">
      <div class="max-w-6xl mx-auto">
       <h2 class="text-3xl font-bold text-gray-800 mb-6">Success Systems Brand Certificates</h2><!-- Certificate Type Selection -->
       <div class="bg-white rounded-xl shadow-md p-6 mb-6">
        <h3 class="text-xl font-bold text-gray-800 mb-4">Select Certificate Type</h3>
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4"><button onclick="selectCertType('teacher')" class="cert-type-btn bg-blue-100 hover:bg-blue-200 p-4 rounded-lg text-center transition-colors">
          <div class="text-3xl mb-2">
           üë®‚Äçüè´
          </div>
          <div class="font-medium">
           Teacher
          </div></button> <button onclick="selectCertType('student')" class="cert-type-btn bg-green-100 hover:bg-green-200 p-4 rounded-lg text-center transition-colors">
          <div class="text-3xl mb-2">
           üéì
          </div>
          <div class="font-medium">
           Student
          </div></button> <button onclick="selectCertType('committee')" class="cert-type-btn bg-purple-100 hover:bg-purple-200 p-4 rounded-lg text-center transition-colors">
          <div class="text-3xl mb-2">
           ü§ù
          </div>
          <div class="font-medium">
           Committee
          </div></button> <button onclick="selectCertType('staff')" class="cert-type-btn bg-yellow-100 hover:bg-yellow-200 p-4 rounded-lg text-center transition-colors">
          <div class="text-3xl mb-2">
           üíº
          </div>
          <div class="font-medium">
           Staff
          </div></button>
        </div>
       </div><!-- Teacher Certificate Form -->
       <div id="teacherCertForm" class="cert-form hidden bg-white rounded-xl shadow-md p-6">
        <h3 class="text-2xl font-bold text-gray-800 mb-6">Teacher Certificate</h3>
        <form id="teacherCertificateForm" class="space-y-4">
         <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div><label for="teacherCertName" class="block text-sm font-medium text-gray-700 mb-1">Teacher Full Name *</label> <input type="text" id="teacherCertName" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
          </div>
          <div><label for="teacherCertSubject" class="block text-sm font-medium text-gray-700 mb-1">Subject/Department *</label> <input type="text" id="teacherCertSubject" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
          </div>
         </div>
         <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div><label for="teacherCertAchievement" class="block text-sm font-medium text-gray-700 mb-1">Achievement/Recognition *</label> <select id="teacherCertAchievement" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"> <option value="">Select Achievement</option> <option value="Outstanding Teaching Performance">Outstanding Teaching Performance</option> <option value="Excellence in Education">Excellence in Education</option> <option value="Innovative Teaching Methods">Innovative Teaching Methods</option> <option value="Student Mentorship Excellence">Student Mentorship Excellence</option> <option value="Professional Development">Professional Development</option> <option value="Community Service">Community Service</option> <option value="Custom">Custom Achievement</option> </select>
          </div>
          <div><label for="teacherCertCustom" class="block text-sm font-medium text-gray-700 mb-1">Custom Achievement (if selected)</label> <input type="text" id="teacherCertCustom" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
          </div>
         </div>
         <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div><label for="teacherCertDate" class="block text-sm font-medium text-gray-700 mb-1">Issue Date *</label> <input type="date" id="teacherCertDate" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
          </div>
          <div><label for="teacherCertId" class="block text-sm font-medium text-gray-700 mb-1">Certificate ID *</label> <input type="text" id="teacherCertId" required placeholder="AUTO-GENERATED" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 bg-gray-50">
          </div>
         </div>
         <div><label for="teacherCertDesc" class="block text-sm font-medium text-gray-700 mb-1">Description/Details</label> <textarea id="teacherCertDesc" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Additional details about the achievement..."></textarea>
         </div>
         <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div><label for="teacherCertIssuer" class="block text-sm font-medium text-gray-700 mb-1">Issued By *</label> <input type="text" id="teacherCertIssuer" required value="Success Systems Brand" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
          </div>
          <div><label for="teacherCertSignature" class="block text-sm font-medium text-gray-700 mb-1">Authorized Signature *</label> <input type="text" id="teacherCertSignature" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
          </div>
         </div>
         <div id="teacherCertMessage" class="hidden text-sm"></div>
         <div class="flex space-x-4"><button type="submit" class="flex-1 bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition-colors font-medium"> Generate &amp; Save Certificate </button> <button type="button" onclick="previewCertificate('teacher')" class="flex-1 bg-green-600 text-white py-3 rounded-lg hover:bg-green-700 transition-colors font-medium"> Preview Certificate </button>
         </div>
        </form>
       </div><!-- Student Certificate Form -->
       <div id="studentCertForm" class="cert-form hidden bg-white rounded-xl shadow-md p-6">
        <h3 class="text-2xl font-bold text-gray-800 mb-6">Student Certificate</h3>
        <form id="studentCertificateForm" class="space-y-4">
         <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div><label for="studentCertName" class="block text-sm font-medium text-gray-700 mb-1">Student Full Name *</label> <input type="text" id="studentCertName" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
          </div>
          <div><label for="studentCertGrade" class="block text-sm font-medium text-gray-700 mb-1">Grade/Class *</label> <input type="text" id="studentCertGrade" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
          </div>
         </div>
         <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div><label for="studentCertAchievement" class="block text-sm font-medium text-gray-700 mb-1">Achievement/Recognition *</label> <select id="studentCertAchievement" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"> <option value="">Select Achievement</option> <option value="Academic Excellence">Academic Excellence</option> <option value="Perfect Attendance">Perfect Attendance</option> <option value="Outstanding Behavior">Outstanding Behavior</option> <option value="Sports Achievement">Sports Achievement</option> <option value="Arts &amp; Creativity">Arts &amp; Creativity</option> <option value="Leadership Award">Leadership Award</option> <option value="Community Service">Community Service</option> <option value="Course Completion">Course Completion</option> <option value="Custom">Custom Achievement</option> </select>
          </div>
          <div><label for="studentCertCustom" class="block text-sm font-medium text-gray-700 mb-1">Custom Achievement (if selected)</label> <input type="text" id="studentCertCustom" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
          </div>
         </div>
         <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div><label for="studentCertDate" class="block text-sm font-medium text-gray-700 mb-1">Issue Date *</label> <input type="date" id="studentCertDate" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
          </div>
          <div><label for="studentCertId" class="block text-sm font-medium text-gray-700 mb-1">Certificate ID *</label> <input type="text" id="studentCertId" required placeholder="AUTO-GENERATED" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 bg-gray-50">
          </div>
         </div>
         <div><label for="studentCertDesc" class="block text-sm font-medium text-gray-700 mb-1">Description/Details</label> <textarea id="studentCertDesc" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Additional details about the achievement..."></textarea>
         </div>
         <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div><label for="studentCertIssuer" class="block text-sm font-medium text-gray-700 mb-1">Issued By *</label> <input type="text" id="studentCertIssuer" required value="Success Systems Brand" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
          </div>
          <div><label for="studentCertSignature" class="block text-sm font-medium text-gray-700 mb-1">Authorized Signature *</label> <input type="text" id="studentCertSignature" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
          </div>
         </div>
         <div id="studentCertMessage" class="hidden text-sm"></div>
         <div class="flex space-x-4"><button type="submit" class="flex-1 bg-green-600 text-white py-3 rounded-lg hover:bg-green-700 transition-colors font-medium"> Generate &amp; Save Certificate </button> <button type="button" onclick="previewCertificate('student')" class="flex-1 bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition-colors font-medium"> Preview Certificate </button>
         </div>
        </form>
       </div><!-- Committee Certificate Form -->
       <div id="committeeCertForm" class="cert-form hidden bg-white rounded-xl shadow-md p-6">
        <h3 class="text-2xl font-bold text-gray-800 mb-6">Committee Member Certificate</h3>
        <form id="committeeCertificateForm" class="space-y-4">
         <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div><label for="committeeCertName" class="block text-sm font-medium text-gray-700 mb-1">Member Full Name *</label> <input type="text" id="committeeCertName" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
          </div>
          <div><label for="committeeCertPosition" class="block text-sm font-medium text-gray-700 mb-1">Position/Role *</label> <input type="text" id="committeeCertPosition" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
          </div>
         </div>
         <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div><label for="committeeCertAchievement" class="block text-sm font-medium text-gray-700 mb-1">Achievement/Recognition *</label> <select id="committeeCertAchievement" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"> <option value="">Select Achievement</option> <option value="Outstanding Service">Outstanding Service</option> <option value="Leadership Excellence">Leadership Excellence</option> <option value="Dedicated Commitment">Dedicated Commitment</option> <option value="Project Completion">Project Completion</option> <option value="Strategic Planning">Strategic Planning</option> <option value="Community Development">Community Development</option> <option value="Term Completion">Term Completion</option> <option value="Custom">Custom Achievement</option> </select>
          </div>
          <div><label for="committeeCertCustom" class="block text-sm font-medium text-gray-700 mb-1">Custom Achievement (if selected)</label> <input type="text" id="committeeCertCustom" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
          </div>
         </div>
         <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div><label for="committeeCertPeriod" class="block text-sm font-medium text-gray-700 mb-1">Service Period *</label> <input type="text" id="committeeCertPeriod" required placeholder="e.g., 2023-2024" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
          </div>
          <div><label for="committeeCertDate" class="block text-sm font-medium text-gray-700 mb-1">Issue Date *</label> <input type="date" id="committeeCertDate" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
          </div>
          <div><label for="committeeCertId" class="block text-sm font-medium text-gray-700 mb-1">Certificate ID *</label> <input type="text" id="committeeCertId" required placeholder="AUTO-GENERATED" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 bg-gray-50">
          </div>
         </div>
         <div><label for="committeeCertDesc" class="block text-sm font-medium text-gray-700 mb-1">Description/Details</label> <textarea id="committeeCertDesc" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Additional details about the service and achievements..."></textarea>
         </div>
         <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div><label for="committeeCertIssuer" class="block text-sm font-medium text-gray-700 mb-1">Issued By *</label> <input type="text" id="committeeCertIssuer" required value="Success Systems Brand" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
          </div>
          <div><label for="committeeCertSignature" class="block text-sm font-medium text-gray-700 mb-1">Authorized Signature *</label> <input type="text" id="committeeCertSignature" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
          </div>
         </div>
         <div id="committeeCertMessage" class="hidden text-sm"></div>
         <div class="flex space-x-4"><button type="submit" class="flex-1 bg-purple-600 text-white py-3 rounded-lg hover:bg-purple-700 transition-colors font-medium"> Generate &amp; Save Certificate </button> <button type="button" onclick="previewCertificate('committee')" class="flex-1 bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition-colors font-medium"> Preview Certificate </button>
         </div>
        </form>
       </div><!-- Staff Certificate Form -->
       <div id="staffCertForm" class="cert-form hidden bg-white rounded-xl shadow-md p-6">
        <h3 class="text-2xl font-bold text-gray-800 mb-6">Staff Certificate</h3>
        <form id="staffCertificateForm" class="space-y-4">
         <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div><label for="staffCertName" class="block text-sm font-medium text-gray-700 mb-1">Staff Full Name *</label> <input type="text" id="staffCertName" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
          </div>
          <div><label for="staffCertPosition" class="block text-sm font-medium text-gray-700 mb-1">Position/Department *</label> <input type="text" id="staffCertPosition" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
          </div>
         </div>
         <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div><label for="staffCertAchievement" class="block text-sm font-medium text-gray-700 mb-1">Achievement/Recognition *</label> <select id="staffCertAchievement" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"> <option value="">Select Achievement</option> <option value="Outstanding Performance">Outstanding Performance</option> <option value="Employee of the Month">Employee of the Month</option> <option value="Employee of the Year">Employee of the Year</option> <option value="Excellent Service">Excellent Service</option> <option value="Years of Service">Years of Service</option> <option value="Innovation &amp; Improvement">Innovation &amp; Improvement</option> <option value="Team Collaboration">Team Collaboration</option> <option value="Training Completion">Training Completion</option> <option value="Custom">Custom Achievement</option> </select>
          </div>
          <div><label for="staffCertCustom" class="block text-sm font-medium text-gray-700 mb-1">Custom Achievement (if selected)</label> <input type="text" id="staffCertCustom" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
          </div>
         </div>
         <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div><label for="staffCertYears" class="block text-sm font-medium text-gray-700 mb-1">Years of Service</label> <input type="number" id="staffCertYears" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
          </div>
          <div><label for="staffCertDate" class="block text-sm font-medium text-gray-700 mb-1">Issue Date *</label> <input type="date" id="staffCertDate" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
          </div>
          <div><label for="staffCertId" class="block text-sm font-medium text-gray-700 mb-1">Certificate ID *</label> <input type="text" id="staffCertId" required placeholder="AUTO-GENERATED" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 bg-gray-50">
          </div>
         </div>
         <div><label for="staffCertDesc" class="block text-sm font-medium text-gray-700 mb-1">Description/Details</label> <textarea id="staffCertDesc" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Additional details about the achievement..."></textarea>
         </div>
         <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div><label for="staffCertIssuer" class="block text-sm font-medium text-gray-700 mb-1">Issued By *</label> <input type="text" id="staffCertIssuer" required value="Success Systems Brand" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
          </div>
          <div><label for="staffCertSignature" class="block text-sm font-medium text-gray-700 mb-1">Authorized Signature *</label> <input type="text" id="staffCertSignature" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
          </div>
         </div>
         <div id="staffCertMessage" class="hidden text-sm"></div>
         <div class="flex space-x-4"><button type="submit" class="flex-1 bg-yellow-600 text-white py-3 rounded-lg hover:bg-yellow-700 transition-colors font-medium"> Generate &amp; Save Certificate </button> <button type="button" onclick="previewCertificate('staff')" class="flex-1 bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition-colors font-medium"> Preview Certificate </button>
         </div>
        </form>
       </div><!-- Certificate Preview Modal -->
       <div id="certPreviewModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 overflow-auto">
        <div class="bg-white rounded-xl shadow-2xl max-w-4xl w-full my-8">
         <div class="p-4 border-b flex justify-between items-center">
          <h3 class="text-xl font-bold text-gray-800">Certificate Preview</h3><button onclick="closeCertPreview()" class="text-gray-500 hover:text-gray-700 text-2xl">√ó</button>
         </div>
         <div id="certPreviewContent" class="p-8"><!-- Certificate will be rendered here -->
         </div>
         <div class="p-4 border-t flex justify-end space-x-3"><button onclick="downloadCertificate()" class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition-colors font-medium"> Download PDF </button> <button onclick="closeCertPreview()" class="bg-gray-300 text-gray-700 px-6 py-2 rounded-lg hover:bg-gray-400 transition-colors font-medium"> Close </button>
         </div>
        </div>
       </div><!-- Saved Certificates List -->
       <div class="bg-white rounded-xl shadow-md p-6 mt-6">
        <h3 class="text-xl font-bold text-gray-800 mb-4">Saved Certificates</h3>
        <div id="savedCertificates" class="space-y-3">
         <p class="text-gray-500 text-sm">No certificates saved yet</p>
        </div>
       </div>
      </div>
     </div><!-- Committee Registration View -->
     <div id="committeeRegView" class="view-content hidden">
      <div class="bg-white rounded-xl shadow-md p-6 max-w-4xl mx-auto">
       <h2 class="text-2xl font-bold text-gray-800 mb-6">Committee Member Registration</h2>
       <form id="committeeForm" class="space-y-6"><!-- Personal Information -->
        <div class="border-b pb-4">
         <h3 class="text-lg font-semibold text-gray-800 mb-3">Personal Information</h3>
         <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div><label for="committeeFirstName" class="block text-sm font-medium text-gray-700 mb-1">First Name *</label> <input type="text" id="committeeFirstName" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
          </div>
          <div><label for="committeeLastName" class="block text-sm font-medium text-gray-700 mb-1">Last Name *</label> <input type="text" id="committeeLastName" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
          </div>
          <div><label for="committeeSex" class="block text-sm font-medium text-gray-700 mb-1">Sex *</label> <select id="committeeSex" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"> <option value="">Select</option> <option value="Male">Male</option> <option value="Female">Female</option> </select>
          </div>
          <div><label for="committeeAge" class="block text-sm font-medium text-gray-700 mb-1">Age *</label> <input type="number" id="committeeAge" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
          </div>
         </div>
        </div><!-- Committee Role -->
        <div class="border-b pb-4">
         <h3 class="text-lg font-semibold text-gray-800 mb-3">Committee Role &amp; Responsibilities</h3>
         <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div><label for="committeePosition" class="block text-sm font-medium text-gray-700 mb-1">Position/Role *</label> <select id="committeePosition" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"> <option value="">Select Position</option> <option value="Chairman">Chairman</option> <option value="Vice Chairman">Vice Chairman</option> <option value="Secretary">Secretary</option> <option value="Treasurer">Treasurer</option> <option value="Member">Member</option> <option value="Other">Other</option> </select>
          </div>
          <div><label for="committeeType" class="block text-sm font-medium text-gray-700 mb-1">Committee Type *</label> <select id="committeeType" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"> <option value="">Select Type</option> <option value="School Board">School Board</option> <option value="Parent Committee">Parent Committee</option> <option value="Finance Committee">Finance Committee</option> <option value="Academic Committee">Academic Committee</option> <option value="Other">Other</option> </select>
          </div>
          <div><label for="committeeStartDate" class="block text-sm font-medium text-gray-700 mb-1">Start Date *</label> <input type="date" id="committeeStartDate" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
          </div>
          <div><label for="committeeEndDate" class="block text-sm font-medium text-gray-700 mb-1">End Date</label> <input type="date" id="committeeEndDate" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
          </div>
         </div>
         <div class="mt-4"><label for="committeeResponsibilities" class="block text-sm font-medium text-gray-700 mb-1">Responsibilities *</label> <textarea id="committeeResponsibilities" required rows="3" placeholder="Describe main responsibilities..." class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"></textarea>
         </div>
        </div><!-- Educational & Professional Background -->
        <div class="border-b pb-4">
         <h3 class="text-lg font-semibold text-gray-800 mb-3">Educational &amp; Professional Background</h3>
         <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div><label for="committeeEducation" class="block text-sm font-medium text-gray-700 mb-1">Education Level</label> <input type="text" id="committeeEducation" placeholder="e.g., Bachelor's, Master's" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
          </div>
          <div><label for="committeeOccupation" class="block text-sm font-medium text-gray-700 mb-1">Occupation</label> <input type="text" id="committeeOccupation" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
          </div>
         </div>
        </div><!-- Contact Information -->
        <div>
         <h3 class="text-lg font-semibold text-gray-800 mb-3">Contact Information</h3>
         <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div><label for="committeePhone" class="block text-sm font-medium text-gray-700 mb-1">Phone Number *</label> <input type="tel" id="committeePhone" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
          </div>
          <div><label for="committeeEmail" class="block text-sm font-medium text-gray-700 mb-1">Email Address</label> <input type="email" id="committeeEmail" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
          </div>
          <div class="md:col-span-2"><label for="committeeAddress" class="block text-sm font-medium text-gray-700 mb-1">Address</label> <textarea id="committeeAddress" rows="2" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"></textarea>
          </div>
         </div>
        </div>
        <div id="committeeMessage" class="hidden text-sm"></div><button type="submit" class="w-full bg-purple-600 text-white py-3 rounded-lg hover:bg-purple-700 transition-colors font-medium text-lg"> Register Committee Member </button>
       </form>
      </div>
     </div><!-- Staff Registration View -->
     <div id="staffRegView" class="view-content hidden">
      <div class="bg-white rounded-xl shadow-md p-6 max-w-4xl mx-auto">
       <h2 class="text-2xl font-bold text-gray-800 mb-6">Staff Registration</h2>
       <form id="staffForm" class="space-y-6"><!-- Personal Information -->
        <div class="border-b pb-4">
         <h3 class="text-lg font-semibold text-gray-800 mb-3">Personal Information</h3>
         <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div><label for="staffFirstName" class="block text-sm font-medium text-gray-700 mb-1">First Name *</label> <input type="text" id="staffFirstName" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
          </div>
          <div><label for="staffLastName" class="block text-sm font-medium text-gray-700 mb-1">Last Name *</label> <input type="text" id="staffLastName" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
          </div>
          <div><label for="staffSex" class="block text-sm font-medium text-gray-700 mb-1">Sex *</label> <select id="staffSex" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"> <option value="">Select</option> <option value="Male">Male</option> <option value="Female">Female</option> </select>
          </div>
          <div><label for="staffAge" class="block text-sm font-medium text-gray-700 mb-1">Age *</label> <input type="number" id="staffAge" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
          </div>
         </div>
        </div><!-- Employment Details -->
        <div class="border-b pb-4">
         <h3 class="text-lg font-semibold text-gray-800 mb-3">Employment Details</h3>
         <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div><label for="staffPosition" class="block text-sm font-medium text-gray-700 mb-1">Position/Title *</label> <input type="text" id="staffPosition" required placeholder="e.g., Librarian, Janitor, Security" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
          </div>
          <div><label for="staffDepartment" class="block text-sm font-medium text-gray-700 mb-1">Department *</label> <select id="staffDepartment" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"> <option value="">Select Department</option> <option value="Administration">Administration</option> <option value="Library">Library</option> <option value="Maintenance">Maintenance</option> <option value="Security">Security</option> <option value="Cafeteria">Cafeteria</option> <option value="IT Support">IT Support</option> <option value="Other">Other</option> </select>
          </div>
          <div><label for="staffEmploymentType" class="block text-sm font-medium text-gray-700 mb-1">Employment Type *</label> <select id="staffEmploymentType" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"> <option value="">Select Type</option> <option value="Full-Time">Full-Time</option> <option value="Part-Time">Part-Time</option> <option value="Contract">Contract</option> </select>
          </div>
          <div><label for="staffHireDate" class="block text-sm font-medium text-gray-700 mb-1">Hire Date *</label> <input type="date" id="staffHireDate" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
          </div>
         </div>
        </div><!-- Salary Information -->
        <div class="border-b pb-4">
         <h3 class="text-lg font-semibold text-gray-800 mb-3">Salary Information</h3>
         <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div><label for="staffSalary" class="block text-sm font-medium text-gray-700 mb-1">Basic Salary (ETB) *</label> <input type="number" id="staffSalary" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
          </div>
          <div><label for="staffPaymentFrequency" class="block text-sm font-medium text-gray-700 mb-1">Payment Frequency *</label> <select id="staffPaymentFrequency" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"> <option value="">Select Frequency</option> <option value="Monthly">Monthly</option> <option value="Bi-Weekly">Bi-Weekly</option> <option value="Weekly">Weekly</option> </select>
          </div>
         </div>
        </div><!-- Education & Skills -->
        <div class="border-b pb-4">
         <h3 class="text-lg font-semibold text-gray-800 mb-3">Education &amp; Skills</h3>
         <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div><label for="staffEducation" class="block text-sm font-medium text-gray-700 mb-1">Education Level</label> <input type="text" id="staffEducation" placeholder="e.g., High School, Diploma" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
          </div>
          <div><label for="staffCertifications" class="block text-sm font-medium text-gray-700 mb-1">Certifications</label> <input type="text" id="staffCertifications" placeholder="e.g., First Aid, Safety" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
          </div>
         </div>
         <div class="mt-4"><label for="staffSkills" class="block text-sm font-medium text-gray-700 mb-1">Skills &amp; Qualifications</label> <textarea id="staffSkills" rows="2" placeholder="List relevant skills..." class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"></textarea>
         </div>
        </div><!-- Contact Information -->
        <div>
         <h3 class="text-lg font-semibold text-gray-800 mb-3">Contact Information</h3>
         <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div><label for="staffPhone" class="block text-sm font-medium text-gray-700 mb-1">Phone Number *</label> <input type="tel" id="staffPhone" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
          </div>
          <div><label for="staffEmail" class="block text-sm font-medium text-gray-700 mb-1">Email Address</label> <input type="email" id="staffEmail" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
          </div>
          <div class="md:col-span-2"><label for="staffAddress" class="block text-sm font-medium text-gray-700 mb-1">Address</label> <textarea id="staffAddress" rows="2" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"></textarea>
          </div>
         </div>
        </div>
        <div id="staffMessage" class="hidden text-sm"></div><button type="submit" class="w-full bg-yellow-600 text-white py-3 rounded-lg hover:bg-yellow-700 transition-colors font-medium text-lg"> Register Staff Member </button>
       </form>
      </div>
     </div><!-- Report Cards View -->
     <div id="reportCardsView" class="view-content hidden">
      <div class="bg-white rounded-xl shadow-md p-6 max-w-5xl mx-auto">
       <h2 class="text-2xl font-bold text-gray-800 mb-6">Student Report Card</h2>
       <form id="reportCardForm" class="space-y-6"><!-- Student Information -->
        <div class="border-b pb-4">
         <h3 class="text-lg font-semibold text-gray-800 mb-3">Student Information</h3>
         <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div><label for="reportStudentName" class="block text-sm font-medium text-gray-700 mb-1">Student Name *</label> <input type="text" id="reportStudentName" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
          </div>
          <div><label for="reportGrade" class="block text-sm font-medium text-gray-700 mb-1">Grade *</label> <select id="reportGrade" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"> <option value="">Select Grade</option> <option value="KG 1">KG 1</option> <option value="KG 2">KG 2</option> <option value="KG 3">KG 3</option> <option value="Grade 1">Grade 1</option> <option value="Grade 2">Grade 2</option> <option value="Grade 3">Grade 3</option> <option value="Grade 4">Grade 4</option> <option value="Grade 5">Grade 5</option> <option value="Grade 6">Grade 6</option> <option value="Grade 7">Grade 7</option> <option value="Grade 8">Grade 8</option> </select>
          </div>
          <div><label for="reportSection" class="block text-sm font-medium text-gray-700 mb-1">Section *</label> <select id="reportSection" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"> <option value="">Select Section</option> <option value="A">Section A</option> <option value="B">Section B</option> </select>
          </div>
          <div><label for="reportSemester" class="block text-sm font-medium text-gray-700 mb-1">Semester *</label> <select id="reportSemester" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"> <option value="">Select Semester</option> <option value="First">First Semester</option> <option value="Second">Second Semester</option> </select>
          </div>
          <div><label for="reportAcademicYear" class="block text-sm font-medium text-gray-700 mb-1">Academic Year *</label> <input type="text" id="reportAcademicYear" required placeholder="e.g., 2023-2024" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
          </div>
         </div>
        </div><!-- Ethiopia/Oromia Curriculum Subjects -->
        <div class="border-b pb-4">
         <h3 class="text-lg font-semibold text-gray-800 mb-3">Ethiopia/Oromia Curriculum Subjects</h3>
         <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
          <div><label for="mathGrade" class="block text-sm font-medium text-gray-700 mb-1">Mathematics</label> <input type="number" id="mathGrade" min="0" max="100" placeholder="0-100" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
          </div>
          <div><label for="englishGrade" class="block text-sm font-medium text-gray-700 mb-1">English</label> <input type="number" id="englishGrade" min="0" max="100" placeholder="0-100" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
          </div>
          <div><label for="amharicGrade" class="block text-sm font-medium text-gray-700 mb-1">Amharic</label> <input type="number" id="amharicGrade" min="0" max="100" placeholder="0-100" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
          </div>
          <div><label for="oromoGrade" class="block text-sm font-medium text-gray-700 mb-1">Afaan Oromo</label> <input type="number" id="oromoGrade" min="0" max="100" placeholder="0-100" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
          </div>
          <div><label for="scienceGrade" class="block text-sm font-medium text-gray-700 mb-1">Science</label> <input type="number" id="scienceGrade" min="0" max="100" placeholder="0-100" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
          </div>
          <div><label for="socialGrade" class="block text-sm font-medium text-gray-700 mb-1">Social Studies</label> <input type="number" id="socialGrade" min="0" max="100" placeholder="0-100" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
          </div>
          <div><label for="peGrade" class="block text-sm font-medium text-gray-700 mb-1">Physical Education</label> <input type="number" id="peGrade" min="0" max="100" placeholder="0-100" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
          </div>
          <div><label for="artGrade" class="block text-sm font-medium text-gray-700 mb-1">Art</label> <input type="number" id="artGrade" min="0" max="100" placeholder="0-100" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
          </div>
         </div>
        </div><!-- Islamic Studies Subjects -->
        <div class="border-b pb-4">
         <h3 class="text-lg font-semibold text-gray-800 mb-3">Islamic Studies Subjects</h3>
         <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
          <div><label for="quranGrade" class="block text-sm font-medium text-gray-700 mb-1">Quran</label> <input type="number" id="quranGrade" min="0" max="100" placeholder="0-100" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
          </div>
          <div><label for="arabicGrade" class="block text-sm font-medium text-gray-700 mb-1">Arabic Language</label> <input type="number" id="arabicGrade" min="0" max="100" placeholder="0-100" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
          </div>
          <div><label for="tarbiyaGrade" class="block text-sm font-medium text-gray-700 mb-1">Tarbiya (Islamic Education)</label> <input type="number" id="tarbiyaGrade" min="0" max="100" placeholder="0-100" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
          </div>
          <div><label for="anashidGrade" class="block text-sm font-medium text-gray-700 mb-1">Anashid (Islamic Songs)</label> <input type="number" id="anashidGrade" min="0" max="100" placeholder="0-100" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
          </div>
         </div>
        </div><!-- Overall Performance -->
        <div class="border-b pb-4">
         <h3 class="text-lg font-semibold text-gray-800 mb-3">Overall Performance</h3>
         <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div><label for="reportTotalMarks" class="block text-sm font-medium text-gray-700 mb-1">Total Marks</label> <input type="number" id="reportTotalMarks" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-gray-50" readonly>
          </div>
          <div><label for="reportAverage" class="block text-sm font-medium text-gray-700 mb-1">Average (%)</label> <input type="number" id="reportAverage" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-gray-50" readonly>
          </div>
          <div><label for="reportRank" class="block text-sm font-medium text-gray-700 mb-1">Class Rank</label> <input type="number" id="reportRank" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
          </div>
         </div>
        </div><!-- Teacher Comments -->
        <div>
         <h3 class="text-lg font-semibold text-gray-800 mb-3">Teacher Comments &amp; Remarks</h3>
         <div class="space-y-4">
          <div><label for="reportTeacherComment" class="block text-sm font-medium text-gray-700 mb-1">Teacher's Comment</label> <textarea id="reportTeacherComment" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Enter teacher's observations and comments..."></textarea>
          </div>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
           <div><label for="reportConduct" class="block text-sm font-medium text-gray-700 mb-1">Conduct</label> <select id="reportConduct" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"> <option value="">Select</option> <option value="Excellent">Excellent</option> <option value="Good">Good</option> <option value="Satisfactory">Satisfactory</option> <option value="Needs Improvement">Needs Improvement</option> </select>
           </div>
           <div><label for="reportAttendance" class="block text-sm font-medium text-gray-700 mb-1">Attendance</label> <input type="text" id="reportAttendance" placeholder="e.g., 95%, 180/190 days" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
           </div>
          </div>
         </div>
        </div>
        <div id="reportCardMessage" class="hidden text-sm"></div>
        <div class="flex space-x-4"><button type="submit" class="flex-1 text-white py-3 rounded-lg transition-all font-medium shadow-lg hover:shadow-xl transform hover:scale-105" style="background: linear-gradient(135deg, #4ECDC4, #45B7D1);"> üíæ Save Report Card </button> <button type="button" onclick="calculateReportAverage()" class="bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition-all font-medium shadow-lg"> üßÆ Calculate Average </button> <button type="button" onclick="exportReportCardsToExcel()" class="bg-purple-600 text-white px-6 py-3 rounded-lg hover:bg-purple-700 transition-all font-medium shadow-lg hover:shadow-xl transform hover:scale-105"> üìä Export All to Excel </button>
        </div>
       </form>
      </div>
     </div><!-- Roster View -->
     <div id="rosterView" class="view-content hidden">
      <div class="bg-white rounded-xl shadow-md p-6 max-w-6xl mx-auto" style="border-top: 6px solid; border-image: linear-gradient(90deg, #FF6B6B, #FFA500, #4ECDC4) 1;">
       <h2 class="text-2xl font-bold mb-6" style="background: linear-gradient(135deg, #FF6B6B, #4ECDC4); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">Class Roster Management</h2><!-- Roster Filter -->
       <div class="bg-gray-50 rounded-lg p-4 mb-6">
        <h3 class="text-lg font-semibold text-gray-800 mb-3">Filter Roster</h3>
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
         <div><label for="rosterFilterGrade" class="block text-sm font-medium text-gray-700 mb-1">Grade</label> <select id="rosterFilterGrade" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"> <option value="">All Grades</option> <option value="KG 1A">KG 1A</option> <option value="KG 1B">KG 1B</option> <option value="KG 2A">KG 2A</option> <option value="KG 2B">KG 2B</option> <option value="KG 3A">KG 3A</option> <option value="KG 3B">KG 3B</option> <option value="Grade 1A">Grade 1A</option> <option value="Grade 1B">Grade 1B</option> <option value="Grade 2A">Grade 2A</option> <option value="Grade 2B">Grade 2B</option> <option value="Grade 3A">Grade 3A</option> <option value="Grade 3B">Grade 3B</option> <option value="Grade 4A">Grade 4A</option> <option value="Grade 4B">Grade 4B</option> <option value="Grade 5A">Grade 5A</option> <option value="Grade 5B">Grade 5B</option> <option value="Grade 6A">Grade 6A</option> <option value="Grade 6B">Grade 6B</option> <option value="Grade 7A">Grade 7A</option> <option value="Grade 7B">Grade 7B</option> <option value="Grade 8A">Grade 8A</option> <option value="Grade 8B">Grade 8B</option> </select>
         </div>
         <div><label for="rosterFilterSemester" class="block text-sm font-medium text-gray-700 mb-1">Semester</label> <select id="rosterFilterSemester" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"> <option value="">All Semesters</option> <option value="First Semester">First Semester</option> <option value="Second Semester">Second Semester</option> </select>
         </div>
         <div><label for="rosterFilterSubject" class="block text-sm font-medium text-gray-700 mb-1">Subject</label> <select id="rosterFilterSubject" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"> <option value="">All Subjects</option> <optgroup label="Ethiopia/Oromia Curriculum"> <option value="Mathematics">Mathematics</option> <option value="English">English</option> <option value="Amharic">Amharic</option> <option value="Afaan Oromo">Afaan Oromo</option> <option value="Science">Science</option> <option value="Social Studies">Social Studies</option> <option value="Physical Education">Physical Education</option> <option value="Art">Art</option> </optgroup> <optgroup label="Islamic Studies"> <option value="Quran">Quran</option> <option value="Arabic">Arabic Language</option> <option value="Tarbiya">Tarbiya</option> <option value="Anashid">Anashid</option> </optgroup> </select>
         </div>
         <div class="flex items-end"><button onclick="filterRoster()" class="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition-colors font-medium"> Apply Filter </button>
         </div>
        </div>
       </div><!-- Add to Roster Form -->
       <form id="rosterForm" class="bg-blue-50 rounded-lg p-4 mb-6">
        <h3 class="text-lg font-semibold text-gray-800 mb-3">Add Student to Roster</h3>
        <div class="grid grid-cols-1 md:grid-cols-5 gap-4">
         <div><label for="rosterStudentName" class="block text-sm font-medium text-gray-700 mb-1">Student Name *</label> <input type="text" id="rosterStudentName" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
         </div>
         <div><label for="rosterGrade" class="block text-sm font-medium text-gray-700 mb-1">Grade *</label> <select id="rosterGrade" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"> <option value="">Select</option> <option value="KG 1A">KG 1A</option> <option value="KG 1B">KG 1B</option> <option value="KG 2A">KG 2A</option> <option value="KG 2B">KG 2B</option> <option value="KG 3A">KG 3A</option> <option value="KG 3B">KG 3B</option> <option value="Grade 1A">Grade 1A</option> <option value="Grade 1B">Grade 1B</option> <option value="Grade 2A">Grade 2A</option> <option value="Grade 2B">Grade 2B</option> <option value="Grade 3A">Grade 3A</option> <option value="Grade 3B">Grade 3B</option> <option value="Grade 4A">Grade 4A</option> <option value="Grade 4B">Grade 4B</option> <option value="Grade 5A">Grade 5A</option> <option value="Grade 5B">Grade 5B</option> <option value="Grade 6A">Grade 6A</option> <option value="Grade 6B">Grade 6B</option> <option value="Grade 7A">Grade 7A</option> <option value="Grade 7B">Grade 7B</option> <option value="Grade 8A">Grade 8A</option> <option value="Grade 8B">Grade 8B</option> </select>
         </div>
         <div><label for="rosterSemester" class="block text-sm font-medium text-gray-700 mb-1">Semester *</label> <select id="rosterSemester" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"> <option value="">Select</option> <option value="First Semester">First Semester</option> <option value="Second Semester">Second Semester</option> </select>
         </div>
         <div><label for="rosterSubject" class="block text-sm font-medium text-gray-700 mb-1">Subject *</label> <select id="rosterSubject" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"> <option value="">Select</option> <optgroup label="Ethiopia/Oromia Curriculum"> <option value="Mathematics">Mathematics</option> <option value="English">English</option> <option value="Amharic">Amharic</option> <option value="Afaan Oromo">Afaan Oromo</option> <option value="Science">Science</option> <option value="Social Studies">Social Studies</option> <option value="Physical Education">Physical Education</option> <option value="Art">Art</option> </optgroup> <optgroup label="Islamic Studies"> <option value="Quran">Quran</option> <option value="Arabic">Arabic Language</option> <option value="Tarbiya">Tarbiya</option> <option value="Anashid">Anashid</option> </optgroup> </select>
         </div>
         <div><label for="rosterTeacher" class="block text-sm font-medium text-gray-700 mb-1">Teacher *</label> <input type="text" id="rosterTeacher" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
         </div>
        </div>
        <div class="mt-4"><button type="submit" class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition-colors font-medium"> Add to Roster </button>
        </div>
        <div id="rosterMessage" class="hidden text-sm mt-3"></div>
       </form><!-- Roster List -->
       <div>
        <h3 class="text-lg font-semibold text-gray-800 mb-3">Current Roster</h3>
        <div id="rosterList" class="space-y-2">
         <p class="text-gray-500 text-sm">No roster entries found</p>
        </div>
       </div>
      </div>
     </div><!-- Teachers Registration View -->
     <div id="teachersRegView" class="view-content hidden">
      <div class="bg-white rounded-xl shadow-2xl p-8 max-w-4xl mx-auto" style="border-top: 8px solid; border-image: linear-gradient(90deg, #FF6B6B, #FFA500, #4ECDC4) 1;">
       <div class="text-center mb-8">
        <div class="text-5xl mb-3">
         üë®‚Äç      
        </div>
        <h2 class="text-3xl font-bold mb-2" style="background: linear-gradient(135deg, #FF6B6B, #FFA500, #4ECDC4); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">Teacher Registration</h2>
        <p class="text-gray-600">Register new teachers with complete professional details</p>
       </div>
       <form id="teacherRegForm" class="space-y-6"><!-- Personal Information -->
        <div class="border-b pb-4">
         <h3 class="text-lg font-semibold text-gray-800 mb-3">Personal Information</h3>
         <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div><label for="teacherFirstName" class="block text-sm font-medium text-gray-700 mb-1">First Name *</label> <input type="text" id="teacherFirstName" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
          </div>
          <div><label for="teacherLastName" class="block text-sm font-medium text-gray-700 mb-1">Last Name *</label> <input type="text" id="teacherLastName" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
          </div>
          <div><label for="teacherSex" class="block text-sm font-medium text-gray-700 mb-1">Sex *</label> <select id="teacherSex" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"> <option value="">Select</option> <option value="Male">Male</option> <option value="Female">Female</option> </select>
          </div>
          <div><label for="teacherAge" class="block text-sm font-medium text-gray-700 mb-1">Age *</label> <input type="number" id="teacherAge" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
          </div>
         </div>
        </div><!-- Educational Qualifications -->
        <div class="border-b pb-4">
         <h3 class="text-lg font-semibold text-gray-800 mb-3">Educational Qualifications</h3>
         <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div><label for="teacherEducation" class="block text-sm font-medium text-gray-700 mb-1">Education Level *</label> <select id="teacherEducation" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"> <option value="">Select Level</option> <option value="B.Ed">B.Ed</option> <option value="M.Ed">M.Ed</option> <option value="B.Sc">B.Sc</option> <option value="M.Sc">M.Sc</option> <option value="BA">BA</option> <option value="MA">MA</option> <option value="PhD">PhD</option> <option value="Diploma">Diploma</option> <option value="Other">Other</option> </select>
          </div>
          <div><label for="teacherUniversity" class="block text-sm font-medium text-gray-700 mb-1">University</label> <input type="text" id="teacherUniversity" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
          </div>
          <div><label for="teacherYearGrad" class="block text-sm font-medium text-gray-700 mb-1">Year Graduated</label> <input type="number" id="teacherYearGrad" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
          </div>
         </div>
        </div><!-- Professional Details -->
        <div class="border-b pb-4">
         <h3 class="text-lg font-semibold text-gray-800 mb-3">Professional Details</h3>
         <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div><label for="teacherYearsService" class="block text-sm font-medium text-gray-700 mb-1">Years of Service *</label> <input type="number" id="teacherYearsService" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
          </div>
          <div><label for="teacherYearJoined" class="block text-sm font-medium text-gray-700 mb-1">Year Joined *</label> <input type="number" id="teacherYearJoined" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
          </div>
          <div><label for="teacherLastPromo" class="block text-sm font-medium text-gray-700 mb-1">Last Promotion Year</label> <input type="number" id="teacherLastPromo" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
          </div>
          <div><label for="teacherNextPromo" class="block text-sm font-medium text-gray-700 mb-1">Next Promotion Year</label> <input type="number" id="teacherNextPromo" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
          </div>
         </div>
        </div><!-- Salary & Scale Information -->
        <div class="border-b pb-4">
         <h3 class="text-lg font-semibold text-gray-800 mb-3">Salary &amp; Scale Information</h3>
         <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div><label for="teacherGovScale" class="block text-sm font-medium text-gray-700 mb-1">Government Scale</label> <input type="text" id="teacherGovScale" placeholder="e.g., Scale 5" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
          </div>
          <div><label for="teacherMadrasaScale" class="block text-sm font-medium text-gray-700 mb-1">Madrasa Scale</label> <input type="text" id="teacherMadrasaScale" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
          </div>
          <div><label for="teacherSalary" class="block text-sm font-medium text-gray-700 mb-1">Basic Salary (ETB) *</label> <input type="number" id="teacherSalary" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
          </div>
         </div>
        </div><!-- Contact & Teaching Info -->
        <div>
         <h3 class="text-lg font-semibold text-gray-800 mb-3">Contact &amp; Teaching Information</h3>
         <div class="space-y-4">
          <div><label for="teacherSubjects" class="block text-sm font-medium text-gray-700 mb-1">Subjects Teaching *</label> <textarea id="teacherSubjects" required rows="2" placeholder="e.g., Mathematics, Science" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"></textarea>
          </div>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
           <div><label for="teacherPhone" class="block text-sm font-medium text-gray-700 mb-1">Phone Number *</label> <input type="tel" id="teacherPhone" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
           </div>
           <div><label for="teacherEmail" class="block text-sm font-medium text-gray-700 mb-1">Email Address</label> <input type="email" id="teacherEmail" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
           </div>
          </div>
         </div>
        </div>
        <div id="teacherRegMessage" class="hidden text-sm"></div><button type="submit" class="w-full text-white py-3 rounded-lg transition-all font-medium shadow-lg hover:shadow-xl transform hover:scale-105" style="background: linear-gradient(135deg, #FF6B6B, #FFA500, #4ECDC4);"> üíæ Register Teacher </button>
       </form>
      </div>
     </div><!-- Sectors Events View -->
     <div id="sectorsEventsView" class="view-content hidden">
      <div class="max-w-6xl mx-auto space-y-6">
       <h2 class="text-3xl font-bold mb-6" style="background: linear-gradient(135deg, #FF6B6B, #FFA500, #4ECDC4); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">Sectors Events &amp; Personal Information</h2><!-- Tab Navigation -->
       <div class="bg-white rounded-xl shadow-md p-4">
        <div class="flex space-x-2"><button onclick="showSectorTab('events')" id="eventsTabBtn" class="px-6 py-3 rounded-lg font-medium transition-all shadow-md text-white" style="background: linear-gradient(135deg, #FF6B6B, #FFA500);"> üìÖ Sector Events </button> <button onclick="showSectorTab('personal')" id="personalTabBtn" class="px-6 py-3 rounded-lg font-medium transition-all text-gray-600 hover:bg-gradient-to-r hover:from-blue-100 hover:to-cyan-100"> üë§ Personal Info </button> <button onclick="showSectorTab('import-export')" id="importExportTabBtn" class="px-6 py-3 rounded-lg font-medium transition-all text-gray-600 hover:bg-gradient-to-r hover:from-green-100 hover:to-teal-100"> üíæ Import/Export </button>
        </div>
       </div><!-- Events Tab Content -->
       <div id="eventsTab" class="sector-tab">
        <div class="bg-white rounded-xl shadow-md p-6" style="border-top: 6px solid; border-image: linear-gradient(90deg, #FF6B6B, #FFA500) 1;">
         <h3 class="text-2xl font-bold mb-4" style="color: #FF6B6B;">Add Sector Event</h3>
         <form id="sectorEventForm" class="space-y-4">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
           <div><label for="eventName" class="block text-sm font-medium text-gray-700 mb-1">Event Name *</label> <input type="text" id="eventName" required class="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent">
           </div>
           <div><label for="eventDate" class="block text-sm font-medium text-gray-700 mb-1">Event Date *</label> <input type="date" id="eventDate" required class="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent">
           </div>
          </div>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
           <div><label for="eventSector" class="block text-sm font-medium text-gray-700 mb-1">Sector *</label> <select id="eventSector" required class="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"> <option value="">Select Sector</option> <option value="Academic">Academic</option> <option value="Sports">Sports</option> <option value="Arts &amp; Culture">Arts &amp; Culture</option> <option value="Community Service">Community Service</option> <option value="Religious Activities">Religious Activities</option> <option value="Administration">Administration</option> <option value="Parent Engagement">Parent Engagement</option> <option value="Staff Development">Staff Development</option> </select>
           </div>
           <div><label for="eventLocation" class="block text-sm font-medium text-gray-700 mb-1">Location</label> <input type="text" id="eventLocation" class="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent">
           </div>
          </div>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
           <div><label for="eventOrganizer" class="block text-sm font-medium text-gray-700 mb-1">Organizer *</label> <input type="text" id="eventOrganizer" required class="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent">
           </div>
           <div><label for="eventParticipants" class="block text-sm font-medium text-gray-700 mb-1">Number of Participants</label> <input type="number" id="eventParticipants" class="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent">
           </div>
          </div>
          <div><label for="eventDescription" class="block text-sm font-medium text-gray-700 mb-1">Event Description *</label> <textarea id="eventDescription" required rows="3" class="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"></textarea>
          </div>
          <div><label for="eventNotes" class="block text-sm font-medium text-gray-700 mb-1">Additional Notes</label> <textarea id="eventNotes" rows="2" class="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"></textarea>
          </div>
          <div id="sectorEventMessage" class="hidden text-sm"></div><button type="submit" class="w-full text-white py-3 rounded-lg transition-all font-medium shadow-lg hover:shadow-xl transform hover:scale-105" style="background: linear-gradient(135deg, #FF6B6B, #FFA500);"> Add Event </button>
         </form>
        </div><!-- Saved Events List -->
        <div class="bg-white rounded-xl shadow-md p-6 mt-6">
         <h3 class="text-xl font-bold mb-4" style="color: #FF6B6B;">Saved Events</h3>
         <div id="savedEventsList" class="space-y-3">
          <p class="text-gray-500 text-sm">No events saved yet</p>
         </div>
        </div>
       </div><!-- Personal Info Tab Content -->
       <div id="personalTab" class="sector-tab hidden">
        <div class="bg-white rounded-xl shadow-md p-6" style="border-top: 6px solid; border-image: linear-gradient(90deg, #4ECDC4, #45B7D1) 1;">
         <h3 class="text-2xl font-bold mb-4" style="color: #4ECDC4;">Add Personal Information</h3>
         <form id="personalInfoForm" class="space-y-4">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
           <div><label for="personFullName" class="block text-sm font-medium text-gray-700 mb-1">Full Name *</label> <input type="text" id="personFullName" required class="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent">
           </div>
           <div><label for="personRole" class="block text-sm font-medium text-gray-700 mb-1">Role *</label> <select id="personRole" required class="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent"> <option value="">Select Role</option> <option value="Teacher">Teacher</option> <option value="Staff">Staff</option> <option value="Committee Member">Committee Member</option> <option value="Student">Student</option> <option value="Parent">Parent</option> </select>
           </div>
          </div>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
           <div><label for="personPhone" class="block text-sm font-medium text-gray-700 mb-1">Phone Number *</label> <input type="tel" id="personPhone" required class="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent">
           </div>
           <div><label for="personEmail" class="block text-sm font-medium text-gray-700 mb-1">Email</label> <input type="email" id="personEmail" class="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent">
           </div>
          </div>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
           <div><label for="personDepartment" class="block text-sm font-medium text-gray-700 mb-1">Department/Grade</label> <input type="text" id="personDepartment" class="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent">
           </div>
           <div><label for="personEmergencyContact" class="block text-sm font-medium text-gray-700 mb-1">Emergency Contact</label> <input type="tel" id="personEmergencyContact" class="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent">
           </div>
          </div>
          <div><label for="personAddress" class="block text-sm font-medium text-gray-700 mb-1">Address</label> <textarea id="personAddress" rows="2" class="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent"></textarea>
          </div>
          <div><label for="personNotes" class="block text-sm font-medium text-gray-700 mb-1">Notes</label> <textarea id="personNotes" rows="2" class="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent"></textarea>
          </div>
          <div id="personalInfoMessage" class="hidden text-sm"></div><button type="submit" class="w-full text-white py-3 rounded-lg transition-all font-medium shadow-lg hover:shadow-xl transform hover:scale-105" style="background: linear-gradient(135deg, #4ECDC4, #45B7D1);"> Save Personal Info </button>
         </form>
        </div><!-- Saved Personal Info List -->
        <div class="bg-white rounded-xl shadow-md p-6 mt-6">
         <h3 class="text-xl font-bold mb-4" style="color: #4ECDC4;">Saved Personal Information</h3>
         <div id="savedPersonalInfoList" class="space-y-3">
          <p class="text-gray-500 text-sm">No personal information saved yet</p>
         </div>
        </div>
       </div><!-- Import/Export Tab Content -->
       <div id="importExportTab" class="sector-tab hidden">
        <div class="bg-white rounded-xl shadow-md p-6" style="border-top: 6px solid; border-image: linear-gradient(90deg, #96CEB4, #4ECDC4) 1;">
         <h3 class="text-2xl font-bold mb-4" style="color: #96CEB4;">Import &amp; Export Data</h3>
         <div class="grid grid-cols-1 md:grid-cols-2 gap-6"><!-- Export to Desktop -->
          <div class="border-2 border-green-200 rounded-lg p-6 bg-gradient-to-br from-green-50 to-teal-50">
           <div class="text-4xl mb-3">
            üíæ
           </div>
           <h4 class="text-xl font-bold text-gray-800 mb-3">Export to Desktop</h4>
           <p class="text-sm text-gray-600 mb-4">Download all sectors data as JSON file to your computer for backup or transfer.</p><button onclick="exportSectorsToDesktop()" class="w-full text-white py-3 rounded-lg transition-all font-medium shadow-lg hover:shadow-xl transform hover:scale-105" style="background: linear-gradient(135deg, #96CEB4, #4ECDC4);"> üì• Export to Desktop </button>
          </div><!-- Import from Desktop -->
          <div class="border-2 border-blue-200 rounded-lg p-6 bg-gradient-to-br from-blue-50 to-cyan-50">
           <div class="text-4xl mb-3">
            üìÇ
           </div>
           <h4 class="text-xl font-bold text-gray-800 mb-3">Import from Desktop</h4>
           <p class="text-sm text-gray-600 mb-4">Upload a JSON file from your computer to restore sectors data.</p><label class="w-full inline-block text-white py-3 rounded-lg transition-all font-medium shadow-lg hover:shadow-xl transform hover:scale-105 text-center cursor-pointer" style="background: linear-gradient(135deg, #45B7D1, #4ECDC4);"> üì§ Choose File from Desktop <input type="file" accept=".json" onchange="importSectorsFromDesktop(event)" class="hidden"> </label>
          </div>
         </div>
         <div id="importExportMessage" class="hidden mt-4"></div><!-- Instructions -->
         <div class="mt-6 p-4 bg-yellow-50 border-2 border-yellow-200 rounded-lg">
          <h5 class="font-bold text-gray-800 mb-2">üìã Instructions:</h5>
          <ul class="text-sm text-gray-700 space-y-1 list-disc list-inside">
           <li><strong>Export to Desktop:</strong> Downloads a JSON backup file to your Downloads folder</li>
           <li><strong>Import from Desktop:</strong> Restores data from a JSON file on your computer</li>
           <li>Import will create new records with new IDs to avoid duplicates</li>
           <li>Maximum 999 total records allowed in the system</li>
           <li>Files are saved with timestamp for easy identification</li>
          </ul>
         </div>
        </div>
       </div>
      </div>
     </div><!-- Teachers Registration View -->
     <div id="teachersRegView" class="view-content hidden">
      <div class="bg-white rounded-xl shadow-md p-6 max-w-4xl mx-auto">
       <h2 class="text-2xl font-bold text-gray-800 mb-6">Teacher Registration</h2>
       <form id="teacherForm" class="space-y-6"><!-- Personal Information -->
        <div class="border-b pb-4">
         <h3 class="text-lg font-semibold text-gray-800 mb-3">Personal Information</h3>
         <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div><label for="teacherFirstName" class="block text-sm font-medium text-gray-700 mb-1">First Name</label> <input type="text" id="teacherFirstName" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
          </div>
          <div><label for="teacherLastName" class="block text-sm font-medium text-gray-700 mb-1">Last Name</label> <input type="text" id="teacherLastName" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
          </div>
          <div><label for="teacherSex" class="block text-sm font-medium text-gray-700 mb-1">Sex</label> <select id="teacherSex" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"> <option value="">Select</option> <option value="Male">Male</option> <option value="Female">Female</option> </select>
          </div>
          <div><label for="teacherAge" class="block text-sm font-medium text-gray-700 mb-1">Age</label> <input type="number" id="teacherAge" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
          </div>
         </div>
        </div><!-- Educational Qualifications -->
        <div class="border-b pb-4">
         <h3 class="text-lg font-semibold text-gray-800 mb-3">Educational Qualifications</h3>
         <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div><label for="teacherEducation" class="block text-sm font-medium text-gray-700 mb-1">Education Level *</label> <select id="teacherEducation" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"> <option value="">Select Level</option> <option value="B.Ed">B.Ed</option> <option value="M.Ed">M.Ed</option> <option value="B.Sc">B.Sc</option> <option value="M.Sc">M.Sc</option> <option value="BA">BA</option> <option value="MA">MA</option> <option value="PhD">PhD</option> <option value="Diploma">Diploma</option> <option value="Other">Other</option> </select>
          </div>
          <div><label for="teacherUniversity" class="block text-sm font-medium text-gray-700 mb-1">University</label> <input type="text" id="teacherUniversity" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
          </div>
          <div><label for="teacherYearGrad" class="block text-sm font-medium text-gray-700 mb-1">Year Graduated</label> <input type="number" id="teacherYearGrad" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
          </div>
         </div>
        </div><!-- Professional Details -->
        <div class="border-b pb-4">
         <h3 class="text-lg font-semibold text-gray-800 mb-3">Professional Details</h3>
         <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div><label for="teacherYearsService" class="block text-sm font-medium text-gray-700 mb-1">Years of Service *</label> <input type="number" id="teacherYearsService" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
          </div>
          <div><label for="teacherYearJoined" class="block text-sm font-medium text-gray-700 mb-1">Year Joined *</label> <input type="number" id="teacherYearJoined" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
          </div>
          <div><label for="teacherLastPromo" class="block text-sm font-medium text-gray-700 mb-1">Last Promotion Year</label> <input type="number" id="teacherLastPromo" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
          </div>
          <div><label for="teacherNextPromo" class="block text-sm font-medium text-gray-700 mb-1">Next Promotion Year</label> <input type="number" id="teacherNextPromo" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
          </div>
         </div>
        </div><!-- Salary & Scale Information -->
        <div class="border-b pb-4">
         <h3 class="text-lg font-semibold text-gray-800 mb-3">Salary &amp; Scale Information</h3>
         <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div><label for="teacherGovScale" class="block text-sm font-medium text-gray-700 mb-1">Government Scale</label> <input type="text" id="teacherGovScale" placeholder="e.g., Scale 5" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
          </div>
          <div><label for="teacherMadrasaScale" class="block text-sm font-medium text-gray-700 mb-1">Madrasa Scale</label> <input type="text" id="teacherMadrasaScale" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
          </div>
          <div><label for="teacherSalary" class="block text-sm font-medium text-gray-700 mb-1">Basic Salary (ETB) *</label> <input type="number" id="teacherSalary" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
          </div>
         </div>
        </div><!-- Contact & Teaching Info -->
        <div>
         <h3 class="text-lg font-semibold text-gray-800 mb-3">Contact &amp; Teaching Information</h3>
         <div class="space-y-4">
          <div><label for="teacherSubjects" class="block text-sm font-medium text-gray-700 mb-1">Subjects Teaching *</label> <textarea id="teacherSubjects" required rows="2" placeholder="e.g., Mathematics, Science" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"></textarea>
          </div>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
           <div><label for="teacherPhone" class="block text-sm font-medium text-gray-700 mb-1">Phone Number *</label> <input type="tel" id="teacherPhone" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
           </div>
           <div><label for="teacherEmail" class="block text-sm font-medium text-gray-700 mb-1">Email Address</label> <input type="email" id="teacherEmail" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
           </div>
          </div>
         </div>
        </div>
        <div id="teacherMessage" class="hidden text-sm"></div><button type="submit" class="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition-colors font-medium text-lg"> Register Teacher </button>
       </form>
      </div>
     </div><!-- Admin Dashboard View -->
     <div id="adminDashboardView" class="view-content hidden">
      <div class="space-y-6">
       <h2 class="text-3xl font-bold text-gray-800">Admin Dashboard</h2><!-- Master Controls -->
       <div class="bg-white rounded-xl shadow-md p-6">
        <h3 class="text-xl font-bold text-gray-800 mb-4">Master Controls</h3>
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4"><button onclick="switchView('attendance')" class="bg-blue-100 hover:bg-blue-200 p-4 rounded-lg text-center transition-colors">
          <div class="text-2xl mb-2">
           üìã
          </div>
          <div class="font-medium">
           Attendance
          </div></button> <button onclick="switchView('missedPeriods')" class="bg-purple-100 hover:bg-purple-200 p-4 rounded-lg text-center transition-colors">
          <div class="text-2xl mb-2">
           üìÖ
          </div>
          <div class="font-medium">
           Missed Periods
          </div></button> <button onclick="switchView('compensated')" class="bg-green-100 hover:bg-green-200 p-4 rounded-lg text-center transition-colors">
          <div class="text-2xl mb-2">
           ‚úÖ
          </div>
          <div class="font-medium">
           Compensated
          </div></button> <button onclick="switchView('familyMeeting')" class="bg-yellow-100 hover:bg-yellow-200 p-4 rounded-lg text-center transition-colors">
          <div class="text-2xl mb-2">
           üë®‚Äçüë©‚Äçüëß
          </div>
          <div class="font-medium">
           Family Meeting
          </div></button> <button onclick="switchView('studentRally')" class="bg-red-100 hover:bg-red-200 p-4 rounded-lg text-center transition-colors">
          <div class="text-2xl mb-2">
           üéØ
          </div>
          <div class="font-medium">
           Student Rally
          </div></button> <button onclick="switchView('teachersReg')" class="bg-indigo-100 hover:bg-indigo-200 p-4 rounded-lg text-center transition-colors">
          <div class="text-2xl mb-2">
           üë®‚Äçüè´
          </div>
          <div class="font-medium">
           Teachers Reg
          </div></button>
        </div>
       </div><!-- Pending Approvals -->
       <div class="bg-white rounded-xl shadow-md p-6">
        <h3 class="text-xl font-bold text-gray-800 mb-4">Pending Approvals</h3>
        <div id="pendingApprovals" class="space-y-3">
         <p class="text-gray-500 text-sm">No pending approvals</p>
        </div>
       </div><!-- User Management -->
       <div class="bg-white rounded-xl shadow-md p-6">
        <h3 class="text-xl font-bold text-gray-800 mb-4">User Management</h3>
        <div id="userManagement" class="space-y-3">
         <p class="text-gray-500 text-sm">Loading users...</p>
        </div>
       </div><!-- Desktop File Operations -->
       <div class="bg-white rounded-xl shadow-md p-6">
        <h3 class="text-xl font-bold text-gray-800 mb-4">File Operations</h3>
        <div class="grid grid-cols-2 md:grid-cols-4 gap-3"><button onclick="downloadDatabase()" class="bg-gray-100 hover:bg-gray-200 px-4 py-3 rounded-lg transition-colors text-sm font-medium"> üì• Download Database </button> <button onclick="exportAllDataToExcel()" class="bg-green-100 hover:bg-green-200 px-4 py-3 rounded-lg transition-colors text-sm font-medium"> üìä Export to Excel </button> <button onclick="showUploadLogo()" class="bg-gray-100 hover:bg-gray-200 px-4 py-3 rounded-lg transition-colors text-sm font-medium">       Upload Logo </button> <button onclick="showSystemSettings()" class="bg-gray-100 hover:bg-gray-200 px-4 py-3 rounded-lg transition-colors text-sm font-medium"> ‚öôÔ∏è System Settings </button>
        </div>
        <div id="adminMessage" class="hidden text-sm mt-4"></div>
       </div><!-- Admin Credentials -->
       <div class="bg-white rounded-xl shadow-md p-6">
        <h3 class="text-xl font-bold text-gray-800 mb-4">Admin Credentials</h3>
        <div class="bg-gradient-to-r from-indigo-50 to-purple-50 p-6 rounded-lg border-2 border-indigo-200">
         <div class="flex items-center justify-between mb-4">
          <div class="flex items-center space-x-3">
           <div class="text-4xl">
            üë§
           </div>
           <div>
            <div class="text-sm text-gray-600 font-medium">
             Administrator Account
            </div>
            <div class="text-xs text-gray-500">
             Default credentials for system access
            </div>
           </div>
          </div>
         </div>
         <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div class="bg-white p-4 rounded-lg shadow-sm">
           <div class="text-xs text-gray-500 uppercase tracking-wide mb-1">
            Username
           </div>
           <div class="text-lg font-bold text-gray-800 font-mono">
            admin
           </div>
          </div>
          <div class="bg-white p-4 rounded-lg shadow-sm">
           <div class="text-xs text-gray-500 uppercase tracking-wide mb-1">
            Password
           </div>
           <div class="text-lg font-bold text-gray-800 font-mono">
            admin123
           </div>
          </div>
         </div>
         <div class="mt-4 text-xs text-indigo-600 bg-indigo-50 p-3 rounded border border-indigo-200">
          ‚ö†Ô∏è <strong>Security Note:</strong> Please change the default password after first login for security purposes.
         </div>
        </div>
       </div><!-- System Statistics -->
       <div class="bg-white rounded-xl shadow-md p-6">
        <h3 class="text-xl font-bold text-gray-800 mb-4">System Statistics</h3>
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
         <div class="bg-blue-50 p-4 rounded-lg">
          <div class="text-3xl font-bold text-blue-600" id="totalRecords">
           0
          </div>
          <div class="text-sm text-gray-600">
           Total Records
          </div>
         </div>
         <div class="bg-green-50 p-4 rounded-lg">
          <div class="text-3xl font-bold text-green-600" id="totalUsers">
           0
          </div>
          <div class="text-sm text-gray-600">
           Total Users
          </div>
         </div>
         <div class="bg-purple-50 p-4 rounded-lg">
          <div class="text-3xl font-bold text-purple-600" id="totalTeachers">
           0
          </div>
          <div class="text-sm text-gray-600">
           Teachers
          </div>
         </div>
         <div class="bg-red-50 p-4 rounded-lg">
          <div class="text-3xl font-bold text-red-600" id="pendingCount">
           0
          </div>
          <div class="text-sm text-gray-600">
           Pending
          </div>
         </div>
        </div>
       </div>
      </div>
     </div>
    </main><!-- Footer -->
    <footer class="shadow-sm border-t-4 mt-auto" style="background: linear-gradient(90deg, #FF6B6B 0%, #FFA500 25%, #4ECDC4 50%, #45B7D1 75%, #96CEB4 100%); border-image: linear-gradient(90deg, #FF6B6B, #FFA500, #4ECDC4) 1;">
     <div class="px-6 py-4 text-center">
      <div class="text-white font-bold text-lg mb-1">
       Meda Imana Primary School
      </div>
      <div class="text-white text-sm opacity-90 mb-2">
       Hirna Town Administration
      </div>
      <div class="text-white text-xs opacity-80">
       Sponsors of System: <a href="https://t.me/khubeintelligencetechnolgies" target="_blank" rel="noopener noreferrer" class="underline hover:text-yellow-200 transition-colors">https://t.me/khubeintelligencetechnolgies</a>
      </div>
     </div>
    </footer>
   </div><!-- Edit User Modal -->
   <div id="editUserModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
    <div class="bg-white rounded-xl shadow-2xl p-6 max-w-md w-full">
     <h3 class="text-xl font-bold text-gray-800 mb-4">Edit User</h3>
     <form id="editUserForm" class="space-y-3"><input type="hidden" id="editUserId">
      <div><label for="editUserName" class="block text-sm font-medium text-gray-700 mb-1">Full Name</label> <input type="text" id="editUserName" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
      </div>
      <div><label for="editUserEmail" class="block text-sm font-medium text-gray-700 mb-1">Email</label> <input type="email" id="editUserEmail" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
      </div>
      <div><label for="editUserPhone" class="block text-sm font-medium text-gray-700 mb-1">Phone</label> <input type="tel" id="editUserPhone" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
      </div>
      <div><label for="editUserRole" class="block text-sm font-medium text-gray-700 mb-1">Role</label> <select id="editUserRole" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"> <option value="teacher">Teacher</option> <option value="staff">Staff</option> <option value="admin">Admin</option> <option value="committee">Committee</option> </select>
      </div>
      <div id="editUserMessage" class="hidden text-sm"></div>
      <div class="flex space-x-3"><button type="submit" class="flex-1 bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition-colors font-medium"> Save Changes </button> <button type="button" onclick="closeEditModal()" class="flex-1 bg-gray-300 text-gray-700 py-2 rounded-lg hover:bg-gray-400 transition-colors font-medium"> Cancel </button>
      </div>
     </form>
    </div>
   </div>
  </div>
  <script>
    const defaultConfig = {
      app_title: "School Management System",
      login_header: "Welcome Back",
      registration_header: "Create Account",
      background_color: "#EFF6FF",
      surface_color: "#FFFFFF",
      text_color: "#1F2937",
      primary_action_color: "#2563EB",
      secondary_action_color: "#10B981"
    };

    let allRecords = [];
    let currentUser = null;
    let recordCount = 0;

    const dataHandler = {
      onDataChanged(data) {
        allRecords = data;
        recordCount = data.length;
        updateAdminDashboard();
        updateSavedCertificates();
        updateRosterList();
        updateSectorsLists();
      }
    };

    async function initApp() {
      const initResult = await window.dataSdk.init(dataHandler);
      if (!initResult.isOk) {
        showMessage('loginError', 'Failed to initialize app. Please refresh.', 'error');
        return;
      }

      // Create default admin account if no users exist
      await createDefaultAdmin();

      if (window.elementSdk) {
        window.elementSdk.init({
          defaultConfig,
          onConfigChange: async (config) => {
            document.getElementById('appTitle').textContent = config.app_title || defaultConfig.app_title;
            document.getElementById('loginHeader').textContent = config.login_header || defaultConfig.login_header;
            document.getElementById('registrationHeader').textContent = config.registration_header || defaultConfig.registration_header;
            
            document.documentElement.style.setProperty('--bg-color', config.background_color || defaultConfig.background_color);
            document.body.style.background = `linear-gradient(to bottom right, ${config.background_color || defaultConfig.background_color}, ${adjustColor(config.background_color || defaultConfig.background_color, -20)})`;
            
            const surfaces = document.querySelectorAll('.bg-white');
            surfaces.forEach(el => el.style.backgroundColor = config.surface_color || defaultConfig.surface_color);
            
            const texts = document.querySelectorAll('.text-gray-800, .text-gray-700, .text-gray-600');
            texts.forEach(el => el.style.color = config.text_color || defaultConfig.text_color);
            
            const primaryBtns = document.querySelectorAll('.bg-blue-600, .text-blue-600');
            primaryBtns.forEach(el => {
              if (el.classList.contains('bg-blue-600')) {
                el.style.backgroundColor = config.primary_action_color || defaultConfig.primary_action_color;
              } else {
                el.style.color = config.primary_action_color || defaultConfig.primary_action_color;
              }
            });
            
            const secondaryBtns = document.querySelectorAll('.bg-green-600');
            secondaryBtns.forEach(el => el.style.backgroundColor = config.secondary_action_color || defaultConfig.secondary_action_color);
          },
          mapToCapabilities: (config) => ({
            recolorables: [
              {
                get: () => config.background_color || defaultConfig.background_color,
                set: (value) => {
                  config.background_color = value;
                  window.elementSdk.setConfig({ background_color: value });
                }
              },
              {
                get: () => config.surface_color || defaultConfig.surface_color,
                set: (value) => {
                  config.surface_color = value;
                  window.elementSdk.setConfig({ surface_color: value });
                }
              },
              {
                get: () => config.text_color || defaultConfig.text_color,
                set: (value) => {
                  config.text_color = value;
                  window.elementSdk.setConfig({ text_color: value });
                }
              },
              {
                get: () => config.primary_action_color || defaultConfig.primary_action_color,
                set: (value) => {
                  config.primary_action_color = value;
                  window.elementSdk.setConfig({ primary_action_color: value });
                }
              },
              {
                get: () => config.secondary_action_color || defaultConfig.secondary_action_color,
                set: (value) => {
                  config.secondary_action_color = value;
                  window.elementSdk.setConfig({ secondary_action_color: value });
                }
              }
            ],
            borderables: [],
            fontEditable: undefined,
            fontSizeable: undefined
          }),
          mapToEditPanelValues: (config) => new Map([
            ["app_title", config.app_title || defaultConfig.app_title],
            ["login_header", config.login_header || defaultConfig.login_header],
            ["registration_header", config.registration_header || defaultConfig.registration_header]
          ])
        });
      }

      setupEventListeners();
    }

    async function createDefaultAdmin() {
      // Check if any admin user exists
      const adminExists = allRecords.some(r => r.__type === 'user' && r.username === 'admin');
      
      if (!adminExists) {
        const adminUser = {
          __type: 'user',
          id: 'admin-' + Date.now().toString(),
          full_name: 'System Administrator',
          username: 'admin',
          password: 'admin123',
          phone_number: '',
          email: 'admin@school.com',
          address: '',
          role: 'admin',
          is_approved: true,
          created_at: new Date().toISOString()
        };
        
        await window.dataSdk.create(adminUser);
      }
    }

    function adjustColor(color, amount) {
      const num = parseInt(color.replace('#', ''), 16);
      const r = Math.max(0, Math.min(255, (num >> 16) + amount));
      const g = Math.max(0, Math.min(255, ((num >> 8) & 0x00FF) + amount));
      const b = Math.max(0, Math.min(255, (num & 0x0000FF) + amount));
      return '#' + ((r << 16) | (g << 8) | b).toString(16).padStart(6, '0');
    }

    function setupEventListeners() {
      document.getElementById('loginForm').addEventListener('submit', handleLogin);
      document.getElementById('registerForm').addEventListener('submit', handleRegister);
      document.getElementById('showRegisterBtn').addEventListener('click', showRegisterScreen);
      document.getElementById('showLoginBtn').addEventListener('click', showLoginScreen);
      document.getElementById('logoutBtn').addEventListener('click', handleLogout);
      
      document.getElementById('attendanceForm').addEventListener('submit', handleAttendance);
      document.getElementById('sectorsForm').addEventListener('submit', handleSectors);
      document.getElementById('compensatedForm').addEventListener('submit', handleCompensated);
      document.getElementById('mariiForm').addEventListener('submit', handleMarii);
      document.getElementById('rallyForm').addEventListener('submit', handleRally);
      document.getElementById('teacherRegForm').addEventListener('submit', handleTeacherReg);
      document.getElementById('committeeForm').addEventListener('submit', handleCommittee);
      document.getElementById('staffForm').addEventListener('submit', handleStaff);
      document.getElementById('reportCardForm').addEventListener('submit', handleReportCard);
      document.getElementById('rosterForm').addEventListener('submit', handleRoster);
      document.getElementById('sectorEventForm').addEventListener('submit', handleSectorEvent);
      document.getElementById('personalInfoForm').addEventListener('submit', handlePersonalInfo);
      document.getElementById('editUserForm').addEventListener('submit', handleEditUser);
      
      document.getElementById('teacherCertificateForm').addEventListener('submit', handleCertificateSubmit);
      document.getElementById('studentCertificateForm').addEventListener('submit', handleCertificateSubmit);
      document.getElementById('committeeCertificateForm').addEventListener('submit', handleCertificateSubmit);
      document.getElementById('staffCertificateForm').addEventListener('submit', handleCertificateSubmit);
      
      // Auto-generate certificate IDs
      generateCertId('teacher');
      generateCertId('student');
      generateCertId('committee');
      generateCertId('staff');
      
      document.querySelectorAll('.nav-btn').forEach(btn => {
        btn.addEventListener('click', (e) => switchView(e.target.dataset.view));
      });
      
      document.querySelectorAll('.period-checkbox').forEach(cb => {
        cb.addEventListener('change', (e) => {
          const num = e.target.id.replace('period', '').replace('Missed', '');
          const details = document.getElementById(`period${num}Details`);
          details.classList.toggle('hidden', !e.target.checked);
        });
      });
      
      document.querySelectorAll('.comp-checkbox').forEach(cb => {
        cb.addEventListener('change', (e) => {
          const num = e.target.id.replace('compPeriod', '');
          const details = document.getElementById(`compPeriod${num}Details`);
          details.classList.toggle('hidden', !e.target.checked);
        });
      });
    }

    function showLoginScreen() {
      document.getElementById('registerScreen').classList.add('hidden');
      document.getElementById('loginScreen').classList.remove('hidden');
    }

    function showRegisterScreen() {
      document.getElementById('loginScreen').classList.add('hidden');
      document.getElementById('registerScreen').classList.remove('hidden');
    }

    async function handleLogin(e) {
      e.preventDefault();
      const username = document.getElementById('loginUsername').value;
      const password = document.getElementById('loginPassword').value;
      
      const user = allRecords.find(r => r.__type === 'user' && r.username === username && r.password === password);
      
      if (user) {
        if (user.is_approved) {
          currentUser = user;
          document.getElementById('loginScreen').classList.add('hidden');
          document.getElementById('mainApp').classList.remove('hidden');
          document.getElementById('loginForm').reset();
          
          // Show admin tabs if user is admin
          if (user.role === 'admin') {
            document.querySelectorAll('.admin-only').forEach(el => el.style.display = 'block');
          }
        } else {
          showMessage('loginError', 'Your account is pending approval.', 'error');
        }
      } else {
        showMessage('loginError', 'Invalid username or password.', 'error');
      }
    }

    async function handleRegister(e) {
      e.preventDefault();
      
      if (recordCount >= 999) {
        showMessage('registerMessage', 'System limit reached. Please contact administrator.', 'error');
        return;
      }
      
      const submitBtn = e.target.querySelector('button[type="submit"]');
      submitBtn.disabled = true;
      submitBtn.textContent = 'Registering...';
      
      const userData = {
        __type: 'user',
        id: Date.now().toString(),
        full_name: document.getElementById('regFullName').value,
        username: document.getElementById('regUsername').value,
        password: document.getElementById('regPassword').value,
        phone_number: document.getElementById('regPhone').value,
        email: document.getElementById('regEmail').value,
        address: document.getElementById('regAddress').value,
        role: document.getElementById('regRole').value,
        is_approved: false,
        created_at: new Date().toISOString()
      };
      
      const result = await window.dataSdk.create(userData);
      
      submitBtn.disabled = false;
      submitBtn.textContent = 'Register';
      
      if (result.isOk) {
        showMessage('registerMessage', 'Registration submitted! Awaiting admin approval.', 'success');
        document.getElementById('registerForm').reset();
        setTimeout(showLoginScreen, 2000);
      } else {
        showMessage('registerMessage', 'Registration failed. Please try again.', 'error');
      }
    }

    function handleLogout() {
      currentUser = null;
      document.getElementById('mainApp').classList.add('hidden');
      document.getElementById('loginScreen').classList.remove('hidden');
      document.querySelectorAll('.admin-only').forEach(el => el.style.display = 'none');
    }

    function showSectorTab(tabName) {
      // Hide all tabs
      document.querySelectorAll('.sector-tab').forEach(tab => tab.classList.add('hidden'));
      
      // Show selected tab
      document.getElementById(`${tabName}Tab`).classList.remove('hidden');
      
      // Update button styles
      const buttons = {
        'events': document.getElementById('eventsTabBtn'),
        'personal': document.getElementById('personalTabBtn'),
        'import-export': document.getElementById('importExportTabBtn')
      };
      
      Object.keys(buttons).forEach(key => {
        if (key === tabName) {
          buttons[key].style.background = 'linear-gradient(135deg, #FF6B6B, #FFA500)';
          buttons[key].classList.add('text-white', 'shadow-md');
          buttons[key].classList.remove('text-gray-600');
        } else {
          buttons[key].style.background = '';
          buttons[key].classList.remove('text-white', 'shadow-md');
          buttons[key].classList.add('text-gray-600');
        }
      });
    }

    function switchView(viewName) {
      document.querySelectorAll('.view-content').forEach(v => v.classList.add('hidden'));
      document.getElementById(`${viewName}View`).classList.remove('hidden');
      
      document.querySelectorAll('.nav-btn').forEach(btn => {
        if (btn.dataset.view === viewName) {
          btn.style.background = 'linear-gradient(135deg, #FF6B6B, #FFA500)';
          btn.classList.add('text-white', 'shadow-md');
          btn.classList.remove('text-gray-600');
        } else {
          btn.style.background = '';
          btn.classList.remove('text-white', 'shadow-md');
          btn.classList.add('text-gray-600');
        }
      });
      
      if (viewName === 'adminDashboard') {
        updateAdminDashboard();
      }
    }

    async function handleAttendance(e) {
      e.preventDefault();
      
      if (recordCount >= 999) {
        showMessage('attMessage', 'Maximum limit of 999 records reached. Please delete some records first.', 'error');
        return;
      }
      
      const submitBtn = e.target.querySelector('button[type="submit"]');
      submitBtn.disabled = true;
      submitBtn.textContent = 'Saving...';
      
      const timeIn = document.getElementById('timeIn').value;
      const timeOut = document.getElementById('timeOut').value;
      let hoursWorked = null;
      
      if (timeIn && timeOut) {
        const [inH, inM] = timeIn.split(':').map(Number);
        const [outH, outM] = timeOut.split(':').map(Number);
        hoursWorked = ((outH * 60 + outM) - (inH * 60 + inM)) / 60;
      }
      
      const record = {
        __type: 'attendance',
        id: Date.now().toString(),
        person_type: document.getElementById('personType').value,
        name: document.getElementById('attName').value,
        date: document.getElementById('attDate').value,
        time_in: timeIn,
        time_out: timeOut,
        status: document.getElementById('attStatus').value,
        notes: document.getElementById('attNotes').value,
        hours_worked: hoursWorked,
        created_at: new Date().toISOString()
      };
      
      const result = await window.dataSdk.create(record);
      
      submitBtn.disabled = false;
      submitBtn.textContent = 'Save Attendance';
      
      if (result.isOk) {
        showMessage('attMessage', 'Attendance saved successfully!', 'success');
        e.target.reset();
      } else {
        showMessage('attMessage', 'Failed to save attendance. Please try again.', 'error');
      }
    }

    async function handleSectors(e) {
      e.preventDefault();
      
      if (recordCount >= 999) {
        showMessage('sectorsMessage', 'Maximum limit of 999 records reached. Please delete some records first.', 'error');
        return;
      }
      
      const submitBtn = e.target.querySelector('button[type="submit"]');
      submitBtn.disabled = true;
      submitBtn.textContent = 'Saving...';
      
      const record = {
        __type: 'missed_periods',
        id: Date.now().toString(),
        row_number: Number(document.getElementById('sectorsRowNum').value),
        teacher_name: document.getElementById('sectorsTeacher').value,
        day: document.getElementById('sectorsDay').value,
        period1_missed: document.getElementById('period1Missed').checked,
        period1_subject: document.getElementById('period1Subject').value,
        period1_grade: document.getElementById('period1Grade').value,
        period1_minutes: Number(document.getElementById('period1Minutes').value) || null,
        period2_missed: document.getElementById('period2Missed').checked,
        period2_subject: document.getElementById('period2Subject').value,
        period2_grade: document.getElementById('period2Grade').value,
        period2_minutes: Number(document.getElementById('period2Minutes').value) || null,
        period3_missed: document.getElementById('period3Missed').checked,
        period3_subject: document.getElementById('period3Subject').value,
        period3_grade: document.getElementById('period3Grade').value,
        period3_minutes: Number(document.getElementById('period3Minutes').value) || null,
        period4_missed: document.getElementById('period4Missed').checked,
        period4_subject: document.getElementById('period4Subject').value,
        period4_grade: document.getElementById('period4Grade').value,
        period4_minutes: Number(document.getElementById('period4Minutes').value) || null,
        period5_missed: document.getElementById('period5Missed').checked,
        period5_subject: document.getElementById('period5Subject').value,
        period5_grade: document.getElementById('period5Grade').value,
        period5_minutes: Number(document.getElementById('period5Minutes').value) || null,
        period6_missed: document.getElementById('period6Missed').checked,
        period6_subject: document.getElementById('period6Subject').value,
        period6_grade: document.getElementById('period6Grade').value,
        period6_minutes: Number(document.getElementById('period6Minutes').value) || null,
        period7_missed: document.getElementById('period7Missed').checked,
        period7_subject: document.getElementById('period7Subject').value,
        period7_grade: document.getElementById('period7Grade').value,
        period7_minutes: Number(document.getElementById('period7Minutes').value) || null,
        period8_missed: document.getElementById('period8Missed').checked,
        period8_subject: document.getElementById('period8Subject').value,
        period8_grade: document.getElementById('period8Grade').value,
        period8_minutes: Number(document.getElementById('period8Minutes').value) || null,
        reason: document.getElementById('sectorsReason').value,
        teacher_signature: document.getElementById('sectorsSignature').value,
        created_at: new Date().toISOString()
      };
      
      const result = await window.dataSdk.create(record);
      
      submitBtn.disabled = false;
      submitBtn.textContent = 'Save Missed Periods';
      
      if (result.isOk) {
        showMessage('sectorsMessage', 'Missed periods saved successfully!', 'success');
        e.target.reset();
        document.querySelectorAll('[id$="Details"]').forEach(el => el.classList.add('hidden'));
      } else {
        showMessage('sectorsMessage', 'Failed to save record. Please try again.', 'error');
      }
    }

    async function handleCompensated(e) {
      e.preventDefault();
      
      if (recordCount >= 999) {
        showMessage('compMessage', 'Maximum limit of 999 records reached. Please delete some records first.', 'error');
        return;
      }
      
      const submitBtn = e.target.querySelector('button[type="submit"]');
      submitBtn.disabled = true;
      submitBtn.textContent = 'Saving...';
      
      const record = {
        __type: 'compensated',
        id: Date.now().toString(),
        row_number: Number(document.getElementById('compRowNum').value),
        teacher_name: document.getElementById('compTeacher').value,
        day: document.getElementById('compDay').value,
        period1_compensated: document.getElementById('compPeriod1').checked,
        period1_subject: document.getElementById('compPeriod1Subject').value,
        period1_grade: document.getElementById('compPeriod1Grade').value,
        period2_compensated: document.getElementById('compPeriod2').checked,
        period2_subject: document.getElementById('compPeriod2Subject').value,
        period2_grade: document.getElementById('compPeriod2Grade').value,
        period3_compensated: document.getElementById('compPeriod3').checked,
        period3_subject: document.getElementById('compPeriod3Subject').value,
        period3_grade: document.getElementById('compPeriod3Grade').value,
        period4_compensated: document.getElementById('compPeriod4').checked,
        period4_subject: document.getElementById('compPeriod4Subject').value,
        period4_grade: document.getElementById('compPeriod4Grade').value,
        period5_compensated: document.getElementById('compPeriod5').checked,
        period5_subject: document.getElementById('compPeriod5Subject').value,
        period5_grade: document.getElementById('compPeriod5Grade').value,
        period6_compensated: document.getElementById('compPeriod6').checked,
        period6_subject: document.getElementById('compPeriod6Subject').value,
        period6_grade: document.getElementById('compPeriod6Grade').value,
        period7_compensated: document.getElementById('compPeriod7').checked,
        period7_subject: document.getElementById('compPeriod7Subject').value,
        period7_grade: document.getElementById('compPeriod7Grade').value,
        period8_compensated: document.getElementById('compPeriod8').checked,
        period8_subject: document.getElementById('compPeriod8Subject').value,
        period8_grade: document.getElementById('compPeriod8Grade').value,
        notes: document.getElementById('compNotes').value,
        teacher_signature: document.getElementById('compSignature').value,
        created_at: new Date().toISOString()
      };
      
      const result = await window.dataSdk.create(record);
      
      submitBtn.disabled = false;
      submitBtn.textContent = 'Save Compensated Periods';
      
      if (result.isOk) {
        showMessage('compMessage', 'Compensated periods saved successfully!', 'success');
        e.target.reset();
        document.querySelectorAll('[id^="compPeriod"][id$="Details"]').forEach(el => el.classList.add('hidden'));
      } else {
        showMessage('compMessage', 'Failed to save record. Please try again.', 'error');
      }
    }

    async function handleMarii(e) {
      e.preventDefault();
      
      if (recordCount >= 999) {
        showMessage('mariiMessage', 'Maximum limit of 999 records reached. Please delete some records first.', 'error');
        return;
      }
      
      const submitBtn = e.target.querySelector('button[type="submit"]');
      submitBtn.disabled = true;
      submitBtn.textContent = 'Saving...';
      
      const record = {
        __type: 'family_meeting',
        id: Date.now().toString(),
        row_number: Number(document.getElementById('mariiRowNum').value),
        student_name: document.getElementById('mariiStudent').value,
        grade: document.getElementById('mariiGrade').value,
        parent_guardian_name: document.getElementById('mariiParent').value,
        phone_number: document.getElementById('mariiPhone').value,
        meeting_date: document.getElementById('mariiDate').value,
        meeting_time: document.getElementById('mariiTime').value,
        attendance_status: document.getElementById('mariiAttendance').value,
        meeting_topic: document.getElementById('mariiTopic').value,
        meeting_notes: document.getElementById('mariiNotes').value,
        signature: document.getElementById('mariiSignature').value,
        created_at: new Date().toISOString()
      };
      
      const result = await window.dataSdk.create(record);
      
      submitBtn.disabled = false;
      submitBtn.textContent = 'Save Family Meeting';
      
      if (result.isOk) {
        showMessage('mariiMessage', 'Family meeting saved successfully!', 'success');
        e.target.reset();
      } else {
        showMessage('mariiMessage', 'Failed to save record. Please try again.', 'error');
      }
    }

    async function handleRally(e) {
      e.preventDefault();
      
      if (recordCount >= 999) {
        showMessage('rallyMessage', 'Maximum limit of 999 records reached. Please delete some records first.', 'error');
        return;
      }
      
      const submitBtn = e.target.querySelector('button[type="submit"]');
      submitBtn.disabled = true;
      submitBtn.textContent = 'Saving...';
      
      const record = {
        __type: 'student_rally',
        id: Date.now().toString(),
        row_number: Number(document.getElementById('rallyRowNum').value),
        teacher_name: document.getElementById('rallyTeacher').value,
        date: document.getElementById('rallyDate').value,
        issue_not_attended_rally: document.getElementById('issue1').checked,
        issue_no_gown: document.getElementById('issue2').checked,
        issue_student_protection: document.getElementById('issue3').checked,
        issue_discipline_violated: document.getElementById('issue4').checked,
        issue_no_circle: document.getElementById('issue5').checked,
        issue_no_garden: document.getElementById('issue6').checked,
        issue_no_weekly_plan: document.getElementById('issue7').checked,
        issue_no_monthly_plan: document.getElementById('issue8').checked,
        issue_no_assembly: document.getElementById('issue9').checked,
        issue_no_yearly_plan: document.getElementById('issue10').checked,
        issue_no_grade_improvement: document.getElementById('issue11').checked,
        additional_notes: document.getElementById('rallyNotes').value,
        supervisor_signature: document.getElementById('rallySignature').value,
        created_at: new Date().toISOString()
      };
      
      const result = await window.dataSdk.create(record);
      
      submitBtn.disabled = false;
      submitBtn.textContent = 'üíæ Save Rally Record';
      
      if (result.isOk) {
        showMessage('rallyMessage', 'Rally record saved successfully!', 'success');
        e.target.reset();
        updateRallyRecordsList();
      } else {
        showMessage('rallyMessage', 'Failed to save record. Please try again.', 'error');
      }
    }

    async function handleTeacher(e) {
      e.preventDefault();
      
      if (recordCount >= 999) {
        showMessage('teacherMessage', 'Maximum limit of 999 records reached. Please delete some records first.', 'error');
        return;
      }
      
      const submitBtn = e.target.querySelector('button[type="submit"]');
      submitBtn.disabled = true;
      submitBtn.textContent = 'Registering...';
      
      const record = {
        __type: 'teacher',
        id: Date.now().toString(),
        first_name: document.getElementById('teacherFirstName').value,
        last_name: document.getElementById('teacherLastName').value,
        sex: document.getElementById('teacherSex').value,
        age: Number(document.getElementById('teacherAge').value),
        education_level: document.getElementById('teacherEducation').value,
        university: document.getElementById('teacherUniversity').value,
        year_graduated: Number(document.getElementById('teacherYearGrad').value) || null,
        years_of_service: Number(document.getElementById('teacherYearsService').value),
        year_joined: Number(document.getElementById('teacherYearJoined').value),
        last_promotion_year: Number(document.getElementById('teacherLastPromo').value) || null,
        next_promotion_year: Number(document.getElementById('teacherNextPromo').value) || null,
        government_scale: document.getElementById('teacherGovScale').value,
        madrasa_scale: document.getElementById('teacherMadrasaScale').value,
        basic_salary: Number(document.getElementById('teacherSalary').value),
        subjects_teaching: document.getElementById('teacherSubjects').value,
        phone_number: document.getElementById('teacherPhone').value,
        email: document.getElementById('teacherEmail').value,
        created_at: new Date().toISOString()
      };
      
      const result = await window.dataSdk.create(record);
      
      submitBtn.disabled = false;
      submitBtn.textContent = 'Register Teacher';
      
      if (result.isOk) {
        showMessage('teacherMessage', 'Teacher registered successfully!', 'success');
        e.target.reset();
      } else {
        showMessage('teacherMessage', 'Failed to register teacher. Please try again.', 'error');
      }
    }

    async function handleTeacherReg(e) {
      e.preventDefault();
      
      if (recordCount >= 999) {
        showMessage('teacherRegMessage', 'Maximum limit of 999 records reached. Please delete some records first.', 'error');
        return;
      }
      
      const submitBtn = e.target.querySelector('button[type="submit"]');
      submitBtn.disabled = true;
      submitBtn.textContent = 'Registering...';
      
      const record = {
        __type: 'teacher',
        id: Date.now().toString(),
        first_name: document.getElementById('teacherFirstName').value,
        last_name: document.getElementById('teacherLastName').value,
        sex: document.getElementById('teacherSex').value,
        age: Number(document.getElementById('teacherAge').value),
        education_level: document.getElementById('teacherEducation').value,
        university: document.getElementById('teacherUniversity').value,
        year_graduated: Number(document.getElementById('teacherYearGrad').value) || null,
        years_of_service: Number(document.getElementById('teacherYearsService').value),
        year_joined: Number(document.getElementById('teacherYearJoined').value),
        last_promotion_year: Number(document.getElementById('teacherLastPromo').value) || null,
        next_promotion_year: Number(document.getElementById('teacherNextPromo').value) || null,
        government_scale: document.getElementById('teacherGovScale').value,
        madrasa_scale: document.getElementById('teacherMadrasaScale').value,
        basic_salary: Number(document.getElementById('teacherSalary').value),
        subjects_teaching: document.getElementById('teacherSubjects').value,
        phone_number: document.getElementById('teacherPhone').value,
        email: document.getElementById('teacherEmail').value,
        created_at: new Date().toISOString()
      };
      
      const result = await window.dataSdk.create(record);
      
      submitBtn.disabled = false;
      submitBtn.textContent = 'üíæ Register Teacher';
      
      if (result.isOk) {
        showMessage('teacherRegMessage', 'Teacher registered successfully!', 'success');
        e.target.reset();
      } else {
        showMessage('teacherRegMessage', 'Failed to register teacher. Please try again.', 'error');
      }
    }

    async function handleCommittee(e) {
      e.preventDefault();
      
      if (recordCount >= 999) {
        showMessage('committeeMessage', 'Maximum limit of 999 records reached. Please delete some records first.', 'error');
        return;
      }
      
      const submitBtn = e.target.querySelector('button[type="submit"]');
      submitBtn.disabled = true;
      submitBtn.textContent = 'Registering...';
      
      const record = {
        __type: 'committee_member',
        id: Date.now().toString(),
        first_name: document.getElementById('committeeFirstName').value,
        last_name: document.getElementById('committeeLastName').value,
        sex: document.getElementById('committeeSex').value,
        age: Number(document.getElementById('committeeAge').value),
        position: document.getElementById('committeePosition').value,
        committee_type: document.getElementById('committeeType').value,
        start_date: document.getElementById('committeeStartDate').value,
        end_date: document.getElementById('committeeEndDate').value,
        responsibilities: document.getElementById('committeeResponsibilities').value,
        education_level: document.getElementById('committeeEducation').value,
        occupation: document.getElementById('committeeOccupation').value,
        phone_number: document.getElementById('committeePhone').value,
        email: document.getElementById('committeeEmail').value,
        address: document.getElementById('committeeAddress').value,
        created_at: new Date().toISOString()
      };
      
      const result = await window.dataSdk.create(record);
      
      submitBtn.disabled = false;
      submitBtn.textContent = 'Register Committee Member';
      
      if (result.isOk) {
        showMessage('committeeMessage', 'Committee member registered successfully!', 'success');
        e.target.reset();
      } else {
        showMessage('committeeMessage', 'Failed to register committee member. Please try again.', 'error');
      }
    }

    async function handleStaff(e) {
      e.preventDefault();
      
      if (recordCount >= 999) {
        showMessage('staffMessage', 'Maximum limit of 999 records reached. Please delete some records first.', 'error');
        return;
      }
      
      const submitBtn = e.target.querySelector('button[type="submit"]');
      submitBtn.disabled = true;
      submitBtn.textContent = 'Registering...';
      
      const record = {
        __type: 'staff_member',
        id: Date.now().toString(),
        first_name: document.getElementById('staffFirstName').value,
        last_name: document.getElementById('staffLastName').value,
        sex: document.getElementById('staffSex').value,
        age: Number(document.getElementById('staffAge').value),
        position: document.getElementById('staffPosition').value,
        department: document.getElementById('staffDepartment').value,
        employment_type: document.getElementById('staffEmploymentType').value,
        hire_date: document.getElementById('staffHireDate').value,
        basic_salary: Number(document.getElementById('staffSalary').value),
        payment_frequency: document.getElementById('staffPaymentFrequency').value,
        education_level: document.getElementById('staffEducation').value,
        certifications: document.getElementById('staffCertifications').value,
        skills: document.getElementById('staffSkills').value,
        phone_number: document.getElementById('staffPhone').value,
        email: document.getElementById('staffEmail').value,
        address: document.getElementById('staffAddress').value,
        created_at: new Date().toISOString()
      };
      
      const result = await window.dataSdk.create(record);
      
      submitBtn.disabled = false;
      submitBtn.textContent = 'Register Staff Member';
      
      if (result.isOk) {
        showMessage('staffMessage', 'Staff member registered successfully!', 'success');
        e.target.reset();
      } else {
        showMessage('staffMessage', 'Failed to register staff member. Please try again.', 'error');
      }
    }

    async function handleReportCard(e) {
      e.preventDefault();
      
      if (recordCount >= 999) {
        showMessage('reportCardMessage', 'Maximum limit of 999 records reached. Please delete some records first.', 'error');
        return;
      }
      
      const submitBtn = e.target.querySelector('button[type="submit"]');
      submitBtn.disabled = true;
      submitBtn.textContent = 'Saving...';
      
      const record = {
        __type: 'report_card',
        id: Date.now().toString(),
        student_name: document.getElementById('reportStudentName').value,
        grade: document.getElementById('reportGrade').value,
        section: document.getElementById('reportSection').value,
        semester: document.getElementById('reportSemester').value,
        academic_year: document.getElementById('reportAcademicYear').value,
        mathematics: Number(document.getElementById('mathGrade').value) || null,
        english: Number(document.getElementById('englishGrade').value) || null,
        amharic: Number(document.getElementById('amharicGrade').value) || null,
        afaan_oromo: Number(document.getElementById('oromoGrade').value) || null,
        science: Number(document.getElementById('scienceGrade').value) || null,
        social_studies: Number(document.getElementById('socialGrade').value) || null,
        physical_education: Number(document.getElementById('peGrade').value) || null,
        art: Number(document.getElementById('artGrade').value) || null,
        quran: Number(document.getElementById('quranGrade').value) || null,
        arabic: Number(document.getElementById('arabicGrade').value) || null,
        tarbiya: Number(document.getElementById('tarbiyaGrade').value) || null,
        anashid: Number(document.getElementById('anashidGrade').value) || null,
        total_marks: Number(document.getElementById('reportTotalMarks').value) || null,
        average: Number(document.getElementById('reportAverage').value) || null,
        class_rank: Number(document.getElementById('reportRank').value) || null,
        teacher_comment: document.getElementById('reportTeacherComment').value,
        conduct: document.getElementById('reportConduct').value,
        attendance: document.getElementById('reportAttendance').value,
        created_at: new Date().toISOString()
      };
      
      const result = await window.dataSdk.create(record);
      
      submitBtn.disabled = false;
      submitBtn.textContent = 'Save Report Card';
      
      if (result.isOk) {
        showMessage('reportCardMessage', 'Report card saved successfully!', 'success');
        e.target.reset();
      } else {
        showMessage('reportCardMessage', 'Failed to save report card. Please try again.', 'error');
      }
    }

    async function handleRoster(e) {
      e.preventDefault();
      
      if (recordCount >= 999) {
        showMessage('rosterMessage', 'Maximum limit of 999 records reached. Please delete some records first.', 'error');
        return;
      }
      
      const submitBtn = e.target.querySelector('button[type="submit"]');
      submitBtn.disabled = true;
      submitBtn.textContent = 'Adding...';
      
      const record = {
        __type: 'roster',
        id: Date.now().toString(),
        student_name: document.getElementById('rosterStudentName').value,
        grade: document.getElementById('rosterGrade').value,
        semester: document.getElementById('rosterSemester').value,
        subject: document.getElementById('rosterSubject').value,
        teacher: document.getElementById('rosterTeacher').value,
        created_at: new Date().toISOString()
      };
      
      const result = await window.dataSdk.create(record);
      
      submitBtn.disabled = false;
      submitBtn.textContent = 'Add to Roster';
      
      if (result.isOk) {
        showMessage('rosterMessage', 'Student added to roster successfully!', 'success');
        e.target.reset();
        updateRosterList();
      } else {
        showMessage('rosterMessage', 'Failed to add to roster. Please try again.', 'error');
      }
    }

    async function handleSectorEvent(e) {
      e.preventDefault();
      
      if (recordCount >= 999) {
        showMessage('sectorEventMessage', 'Maximum limit of 999 records reached. Please delete some records first.', 'error');
        return;
      }
      
      const submitBtn = e.target.querySelector('button[type="submit"]');
      submitBtn.disabled = true;
      submitBtn.textContent = 'Saving...';
      
      const record = {
        __type: 'sector_event',
        id: Date.now().toString(),
        event_name: document.getElementById('eventName').value,
        event_date: document.getElementById('eventDate').value,
        sector: document.getElementById('eventSector').value,
        location: document.getElementById('eventLocation').value,
        organizer: document.getElementById('eventOrganizer').value,
        participants: Number(document.getElementById('eventParticipants').value) || null,
        description: document.getElementById('eventDescription').value,
        notes: document.getElementById('eventNotes').value,
        created_at: new Date().toISOString()
      };
      
      const result = await window.dataSdk.create(record);
      
      submitBtn.disabled = false;
      submitBtn.textContent = 'Add Event';
      
      if (result.isOk) {
        showMessage('sectorEventMessage', 'Event saved successfully!', 'success');
        e.target.reset();
        updateSectorsLists();
      } else {
        showMessage('sectorEventMessage', 'Failed to save event. Please try again.', 'error');
      }
    }

    async function handlePersonalInfo(e) {
      e.preventDefault();
      
      if (recordCount >= 999) {
        showMessage('personalInfoMessage', 'Maximum limit of 999 records reached. Please delete some records first.', 'error');
        return;
      }
      
      const submitBtn = e.target.querySelector('button[type="submit"]');
      submitBtn.disabled = true;
      submitBtn.textContent = 'Saving...';
      
      const record = {
        __type: 'personal_info',
        id: Date.now().toString(),
        full_name: document.getElementById('personFullName').value,
        role: document.getElementById('personRole').value,
        phone: document.getElementById('personPhone').value,
        email: document.getElementById('personEmail').value,
        department: document.getElementById('personDepartment').value,
        emergency_contact: document.getElementById('personEmergencyContact').value,
        address: document.getElementById('personAddress').value,
        notes: document.getElementById('personNotes').value,
        created_at: new Date().toISOString()
      };
      
      const result = await window.dataSdk.create(record);
      
      submitBtn.disabled = false;
      submitBtn.textContent = 'Save Personal Info';
      
      if (result.isOk) {
        showMessage('personalInfoMessage', 'Personal information saved successfully!', 'success');
        e.target.reset();
        updateSectorsLists();
      } else {
        showMessage('personalInfoMessage', 'Failed to save personal information. Please try again.', 'error');
      }
    }

    function updateSectorsLists() {
      // Update Sector Events List
      const events = allRecords.filter(r => r.__type === 'sector_event');
      const eventsContainer = document.getElementById('savedEventsList');
      
      if (events.length === 0) {
        eventsContainer.innerHTML = '<p class="text-gray-500 text-sm">No events saved yet</p>';
      } else {
        eventsContainer.innerHTML = events.map(event => `
          <div class="flex items-center justify-between bg-purple-50 p-4 rounded-lg border-2 border-purple-200">
            <div class="flex-1">
              <div class="font-bold text-gray-800">${event.event_name}</div>
              <div class="text-sm text-gray-600">
                <span class="font-medium">${event.sector}</span> ‚Ä¢ 
                ${new Date(event.event_date).toLocaleDateString()} ‚Ä¢ 
                ${event.location || 'No location'}
              </div>
              <div class="text-sm text-gray-600">Organizer: ${event.organizer}</div>
              ${event.participants ? `<div class="text-sm text-gray-600">Participants: ${event.participants}</div>` : ''}
              <div class="text-sm text-gray-500 mt-1">${event.description}</div>
            </div>
            <button onclick="deleteSectorEvent('${event.__backendId}')" class="bg-red-500 text-white px-3 py-1 rounded text-sm hover:bg-red-600 ml-4">
              Delete
            </button>
          </div>
        `).join('');
      }
      
      // Update Personal Info List
      const personalInfos = allRecords.filter(r => r.__type === 'personal_info');
      const personalContainer = document.getElementById('savedPersonalInfoList');
      
      if (personalInfos.length === 0) {
        personalContainer.innerHTML = '<p class="text-gray-500 text-sm">No personal information saved yet</p>';
      } else {
        personalContainer.innerHTML = personalInfos.map(info => `
          <div class="flex items-center justify-between bg-green-50 p-4 rounded-lg border-2 border-green-200">
            <div class="flex-1 grid grid-cols-2 md:grid-cols-4 gap-4">
              <div>
                <div class="text-xs text-gray-500">Name</div>
                <div class="font-bold text-gray-800">${info.full_name}</div>
              </div>
              <div>
                <div class="text-xs text-gray-500">Role</div>
                <div class="font-medium text-gray-700">${info.role}</div>
              </div>
              <div>
                <div class="text-xs text-gray-500">Phone</div>
                <div class="text-sm text-gray-700">${info.phone}</div>
              </div>
              <div>
                <div class="text-xs text-gray-500">Department</div>
                <div class="text-sm text-gray-700">${info.department || 'N/A'}</div>
              </div>
            </div>
            <button onclick="deletePersonalInfo('${info.__backendId}')" class="bg-red-500 text-white px-3 py-1 rounded text-sm hover:bg-red-600 ml-4">
              Delete
            </button>
          </div>
        `).join('');
      }
    }

    async function deleteSectorEvent(backendId) {
      const event = allRecords.find(r => r.__backendId === backendId);
      if (!event) return;
      
      const result = await window.dataSdk.delete(event);
      
      if (result.isOk) {
        updateSectorsLists();
      }
    }

    async function deletePersonalInfo(backendId) {
      const info = allRecords.find(r => r.__backendId === backendId);
      if (!info) return;
      
      const result = await window.dataSdk.delete(info);
      
      if (result.isOk) {
        updateSectorsLists();
      }
    }

    function exportSectorsData() {
      const sectorsData = allRecords.filter(r => r.__type === 'sector_event' || r.__type === 'personal_info');
      
      if (sectorsData.length === 0) {
        showImportExportMessage('No sectors data to export', 'error');
        return;
      }
      
      const dataStr = JSON.stringify(sectorsData, null, 2);
      const dataBlob = new Blob([dataStr], { type: 'application/json' });
      const url = URL.createObjectURL(dataBlob);
      const link = document.createElement('a');
      link.href = url;
      link.download = `sectors_data_${new Date().toISOString().split('T')[0]}.json`;
      link.click();
      URL.revokeObjectURL(url);
      
      showImportExportMessage(`Successfully exported ${sectorsData.length} records!`, 'success');
    }

    function exportSectorsToDesktop() {
      const sectorsData = allRecords.filter(r => r.__type === 'sector_event' || r.__type === 'personal_info');
      
      if (sectorsData.length === 0) {
        showImportExportMessage('No sectors data to export', 'error');
        return;
      }
      
      const timestamp = new Date().toISOString().replace(/[:.]/g, '-').split('T');
      const filename = `SuccessSystemsBrand_Sectors_${timestamp[0]}_${timestamp[1].split('-')[0]}.json`;
      
      const dataStr = JSON.stringify(sectorsData, null, 2);
      const dataBlob = new Blob([dataStr], { type: 'application/json' });
      const url = URL.createObjectURL(dataBlob);
      const link = document.createElement('a');
      link.href = url;
      link.download = filename;
      link.click();
      URL.revokeObjectURL(url);
      
      showImportExportMessage(`‚úÖ Successfully exported ${sectorsData.length} records to Desktop!\nFile: ${filename}`, 'success');
    }

    async function importSectorsData(event) {
      const file = event.target.files[0];
      if (!file) return;
      
      const reader = new FileReader();
      reader.onload = async (e) => {
        try {
          const importedData = JSON.parse(e.target.result);
          
          if (!Array.isArray(importedData)) {
            showImportExportMessage('Invalid file format. Expected an array of records.', 'error');
            return;
          }
          
          let successCount = 0;
          let errorCount = 0;
          
          for (const record of importedData) {
            if (recordCount + successCount >= 999) {
              showImportExportMessage(`Import stopped: Maximum limit of 999 records reached. Imported ${successCount} records.`, 'error');
              return;
            }
            
            // Remove __backendId and create as new record
            const { __backendId, ...cleanRecord } = record;
            cleanRecord.id = Date.now().toString() + '-' + Math.random().toString(36).substr(2, 9);
            cleanRecord.created_at = new Date().toISOString();
            
            const result = await window.dataSdk.create(cleanRecord);
            
            if (result.isOk) {
              successCount++;
            } else {
              errorCount++;
            }
          }
          
          if (successCount > 0) {
            showImportExportMessage(`Successfully imported ${successCount} records${errorCount > 0 ? ` (${errorCount} failed)` : ''}!`, 'success');
            updateSectorsLists();
          } else {
            showImportExportMessage('Import failed. No records were imported.', 'error');
          }
        } catch (error) {
          showImportExportMessage('Error reading file. Please ensure it is a valid JSON file.', 'error');
        }
      };
      
      reader.readAsText(file);
      event.target.value = ''; // Reset file input
    }

    async function importSectorsFromDesktop(event) {
      const file = event.target.files[0];
      if (!file) return;
      
      const reader = new FileReader();
      reader.onload = async (e) => {
        try {
          const importedData = JSON.parse(e.target.result);
          
          if (!Array.isArray(importedData)) {
            showImportExportMessage('‚ùå Invalid file format. Expected an array of records.', 'error');
            return;
          }
          
          let successCount = 0;
          let errorCount = 0;
          
          showImportExportMessage(`‚è≥ Importing ${importedData.length} records from desktop...`, 'info');
          
          for (const record of importedData) {
            if (recordCount + successCount >= 999) {
              showImportExportMessage(`‚ö†Ô∏è Import stopped: Maximum limit of 999 records reached. Imported ${successCount} records.`, 'error');
              return;
            }
            
            // Remove __backendId and create as new record
            const { __backendId, ...cleanRecord } = record;
            cleanRecord.id = Date.now().toString() + '-' + Math.random().toString(36).substr(2, 9);
            cleanRecord.created_at = new Date().toISOString();
            
            const result = await window.dataSdk.create(cleanRecord);
            
            if (result.isOk) {
              successCount++;
            } else {
              errorCount++;
            }
          }
          
          if (successCount > 0) {
            showImportExportMessage(`‚úÖ Successfully imported ${successCount} records from desktop${errorCount > 0 ? ` (${errorCount} failed)` : ''}!`, 'success');
            updateSectorsLists();
          } else {
            showImportExportMessage('‚ùå Import failed. No records were imported.', 'error');
          }
        } catch (error) {
          showImportExportMessage('‚ùå Error reading file. Please ensure it is a valid JSON file from a previous export.', 'error');
        }
      };
      
      reader.readAsText(file);
      event.target.value = ''; // Reset file input
    }

    function showImportExportMessage(message, type) {
      const el = document.getElementById('importExportMessage');
      el.textContent = message;
      el.className = type === 'success' 
        ? 'mt-4 p-3 rounded-lg text-sm bg-green-100 border-2 border-green-300 text-green-800' 
        : 'mt-4 p-3 rounded-lg text-sm bg-red-100 border-2 border-red-300 text-red-800';
      el.classList.remove('hidden');
      setTimeout(() => el.classList.add('hidden'), 5000);
    }

    async function handleRoster(e) {
      e.preventDefault();
      
      if (recordCount >= 999) {
        showMessage('rosterMessage', 'Maximum limit of 999 records reached. Please delete some records first.', 'error');
        return;
      }
      
      const submitBtn = e.target.querySelector('button[type="submit"]');
      submitBtn.disabled = true;
      submitBtn.textContent = 'Adding...';
      
      const record = {
        __type: 'roster',
        id: Date.now().toString(),
        student_name: document.getElementById('rosterStudentName').value,
        grade: document.getElementById('rosterGrade').value,
        semester: document.getElementById('rosterSemester').value,
        subject: document.getElementById('rosterSubject').value,
        teacher: document.getElementById('rosterTeacher').value,
        created_at: new Date().toISOString()
      };
      
      const result = await window.dataSdk.create(record);
      
      submitBtn.disabled = false;
      submitBtn.textContent = 'Add to Roster';
      
      if (result.isOk) {
        showMessage('rosterMessage', 'Student added to roster successfully!', 'success');
        e.target.reset();
        updateRosterList();
      } else {
        showMessage('rosterMessage', 'Failed to add to roster. Please try again.', 'error');
      }
    }

    function calculateReportAverage() {
      const grades = [
        'mathGrade', 'englishGrade', 'amharicGrade', 'oromoGrade',
        'scienceGrade', 'socialGrade', 'peGrade', 'artGrade',
        'quranGrade', 'arabicGrade', 'tarbiyaGrade', 'anashidGrade'
      ];
      
      let total = 0;
      let count = 0;
      
      grades.forEach(gradeId => {
        const value = Number(document.getElementById(gradeId).value);
        if (value > 0) {
          total += value;
          count++;
        }
      });
      
      document.getElementById('reportTotalMarks').value = total;
      document.getElementById('reportAverage').value = count > 0 ? (total / count).toFixed(2) : 0;
    }

    function updateRosterList() {
      const rosters = allRecords.filter(r => r.__type === 'roster');
      const container = document.getElementById('rosterList');
      
      if (rosters.length === 0) {
        container.innerHTML = '<p class="text-gray-500 text-sm">No roster entries found</p>';
        return;
      }
      
      container.innerHTML = rosters.map(roster => `
        <div class="flex items-center justify-between bg-gray-50 p-3 rounded-lg border border-gray-200">
          <div class="flex-1 grid grid-cols-5 gap-4">
            <div>
              <div class="text-xs text-gray-500">Student</div>
              <div class="font-medium text-gray-800">${roster.student_name}</div>
            </div>
            <div>
              <div class="text-xs text-gray-500">Grade</div>
              <div class="font-medium text-gray-800">${roster.grade}</div>
            </div>
            <div>
              <div class="text-xs text-gray-500">Semester</div>
              <div class="font-medium text-gray-800">${roster.semester}</div>
            </div>
            <div>
              <div class="text-xs text-gray-500">Subject</div>
              <div class="font-medium text-gray-800">${roster.subject}</div>
            </div>
            <div>
              <div class="text-xs text-gray-500">Teacher</div>
              <div class="font-medium text-gray-800">${roster.teacher}</div>
            </div>
          </div>
          <button onclick="deleteRoster('${roster.__backendId}')" class="bg-red-500 text-white px-3 py-1 rounded text-sm hover:bg-red-600 ml-4">
            Delete
          </button>
        </div>
      `).join('');
    }

    function filterRoster() {
      const grade = document.getElementById('rosterFilterGrade').value;
      const semester = document.getElementById('rosterFilterSemester').value;
      const subject = document.getElementById('rosterFilterSubject').value;
      
      let filtered = allRecords.filter(r => r.__type === 'roster');
      
      if (grade) filtered = filtered.filter(r => r.grade === grade);
      if (semester) filtered = filtered.filter(r => r.semester === semester);
      if (subject) filtered = filtered.filter(r => r.subject === subject);
      
      const container = document.getElementById('rosterList');
      
      if (filtered.length === 0) {
        container.innerHTML = '<p class="text-gray-500 text-sm">No roster entries match the filter</p>';
        return;
      }
      
      container.innerHTML = filtered.map(roster => `
        <div class="flex items-center justify-between bg-gray-50 p-3 rounded-lg border border-gray-200">
          <div class="flex-1 grid grid-cols-5 gap-4">
            <div>
              <div class="text-xs text-gray-500">Student</div>
              <div class="font-medium text-gray-800">${roster.student_name}</div>
            </div>
            <div>
              <div class="text-xs text-gray-500">Grade</div>
              <div class="font-medium text-gray-800">${roster.grade}</div>
            </div>
            <div>
              <div class="text-xs text-gray-500">Semester</div>
              <div class="font-medium text-gray-800">${roster.semester}</div>
            </div>
            <div>
              <div class="text-xs text-gray-500">Subject</div>
              <div class="font-medium text-gray-800">${roster.subject}</div>
            </div>
            <div>
              <div class="text-xs text-gray-500">Teacher</div>
              <div class="font-medium text-gray-800">${roster.teacher}</div>
            </div>
          </div>
          <button onclick="deleteRoster('${roster.__backendId}')" class="bg-red-500 text-white px-3 py-1 rounded text-sm hover:bg-red-600 ml-4">
            Delete
          </button>
        </div>
      `).join('');
    }

    async function deleteRoster(backendId) {
      const roster = allRecords.find(r => r.__backendId === backendId);
      if (!roster) return;
      
      const result = await window.dataSdk.delete(roster);
      
      if (result.isOk) {
        updateRosterList();
      }
    }

    function updateAdminDashboard() {
      if (!currentUser || currentUser.role !== 'admin') return;
      
      // Update statistics
      document.getElementById('totalRecords').textContent = recordCount;
      
      const users = allRecords.filter(r => r.__type === 'user');
      document.getElementById('totalUsers').textContent = users.length;
      
      const teachers = allRecords.filter(r => r.__type === 'teacher');
      document.getElementById('totalTeachers').textContent = teachers.length;
      
      const pending = users.filter(u => !u.is_approved);
      document.getElementById('pendingCount').textContent = pending.length;
      
      // Update pending approvals
      const pendingDiv = document.getElementById('pendingApprovals');
      if (pending.length === 0) {
        pendingDiv.innerHTML = '<p class="text-gray-500 text-sm">No pending approvals</p>';
      } else {
        pendingDiv.innerHTML = pending.map(u => `
          <div class="flex items-center justify-between bg-gray-50 p-3 rounded-lg">
            <div>
              <div class="font-medium">${u.full_name}</div>
              <div class="text-sm text-gray-600">${u.role} - ${u.username}</div>
            </div>
            <div class="flex space-x-2">
              <button onclick="approveUser('${u.__backendId}')" class="bg-green-500 text-white px-3 py-1 rounded text-sm hover:bg-green-600">
                Approve
              </button>
              <button onclick="rejectUser('${u.__backendId}')" class="bg-red-500 text-white px-3 py-1 rounded text-sm hover:bg-red-600">
                Reject
              </button>
            </div>
          </div>
        `).join('');
      }
      
      // Update user management
      const userDiv = document.getElementById('userManagement');
      const approvedUsers = users.filter(u => u.is_approved);
      if (approvedUsers.length === 0) {
        userDiv.innerHTML = '<p class="text-gray-500 text-sm">No users found</p>';
      } else {
        userDiv.innerHTML = approvedUsers.map(u => `
          <div class="flex items-center justify-between bg-gray-50 p-3 rounded-lg">
            <div>
              <div class="font-medium">${u.full_name}</div>
              <div class="text-sm text-gray-600">${u.role} - ${u.email || 'No email'}</div>
            </div>
            <div class="flex space-x-2">
              <button onclick="editUser('${u.__backendId}')" class="bg-blue-500 text-white px-3 py-1 rounded text-sm hover:bg-blue-600">
                Edit
              </button>
              <button onclick="deleteUser('${u.__backendId}')" class="bg-red-500 text-white px-3 py-1 rounded text-sm hover:bg-red-600">
                Delete
              </button>
            </div>
          </div>
        `).join('');
      }
    }

    async function approveUser(backendId) {
      const user = allRecords.find(r => r.__backendId === backendId);
      if (!user) return;
      
      user.is_approved = true;
      const result = await window.dataSdk.update(user);
      
      if (result.isOk) {
        showMessage('adminMessage', 'User approved successfully!', 'success');
      } else {
        showMessage('adminMessage', 'Failed to approve user.', 'error');
      }
    }

    async function rejectUser(backendId) {
      const user = allRecords.find(r => r.__backendId === backendId);
      if (!user) return;
      
      const result = await window.dataSdk.delete(user);
      
      if (result.isOk) {
        showMessage('adminMessage', 'User rejected and removed.', 'success');
      } else {
        showMessage('adminMessage', 'Failed to reject user.', 'error');
      }
    }

    function editUser(backendId) {
      const user = allRecords.find(r => r.__backendId === backendId);
      if (!user) return;
      
      document.getElementById('editUserId').value = backendId;
      document.getElementById('editUserName').value = user.full_name;
      document.getElementById('editUserEmail').value = user.email || '';
      document.getElementById('editUserPhone').value = user.phone_number || '';
      document.getElementById('editUserRole').value = user.role;
      
      document.getElementById('editUserModal').classList.remove('hidden');
    }

    function closeEditModal() {
      document.getElementById('editUserModal').classList.add('hidden');
      document.getElementById('editUserForm').reset();
    }

    async function handleEditUser(e) {
      e.preventDefault();
      
      const backendId = document.getElementById('editUserId').value;
      const user = allRecords.find(r => r.__backendId === backendId);
      if (!user) return;
      
      const submitBtn = e.target.querySelector('button[type="submit"]');
      submitBtn.disabled = true;
      submitBtn.textContent = 'Saving...';
      
      user.full_name = document.getElementById('editUserName').value;
      user.email = document.getElementById('editUserEmail').value;
      user.phone_number = document.getElementById('editUserPhone').value;
      user.role = document.getElementById('editUserRole').value;
      
      const result = await window.dataSdk.update(user);
      
      submitBtn.disabled = false;
      submitBtn.textContent = 'Save Changes';
      
      if (result.isOk) {
        showMessage('editUserMessage', 'User updated successfully!', 'success');
        setTimeout(closeEditModal, 1500);
      } else {
        showMessage('editUserMessage', 'Failed to update user.', 'error');
      }
    }

    async function deleteUser(backendId) {
      const user = allRecords.find(r => r.__backendId === backendId);
      if (!user) return;
      
      // Create inline confirmation
      const userDiv = event.target.closest('.bg-gray-50');
      const originalContent = userDiv.innerHTML;
      
      userDiv.innerHTML = `
        <div class="flex items-center justify-between">
          <span class="text-red-600 font-medium">Delete this user?</span>
          <div class="flex space-x-2">
            <button onclick="confirmDeleteUser('${backendId}')" class="bg-red-600 text-white px-3 py-1 rounded text-sm hover:bg-red-700">
              Confirm
            </button>
            <button onclick="cancelDelete(this, \`${originalContent.replace(/`/g, '\\`')}\`)" class="bg-gray-300 text-gray-700 px-3 py-1 rounded text-sm hover:bg-gray-400">
              Cancel
            </button>
          </div>
        </div>
      `;
    }

    async function confirmDeleteUser(backendId) {
      const user = allRecords.find(r => r.__backendId === backendId);
      if (!user) return;
      
      const result = await window.dataSdk.delete(user);
      
      if (result.isOk) {
        showMessage('adminMessage', 'User deleted successfully!', 'success');
      } else {
        showMessage('adminMessage', 'Failed to delete user.', 'error');
      }
    }

    function cancelDelete(btn, originalContent) {
      const userDiv = btn.closest('.bg-gray-50');
      userDiv.innerHTML = originalContent;
    }

    function downloadDatabase() {
      const dataStr = JSON.stringify(allRecords, null, 2);
      const dataBlob = new Blob([dataStr], { type: 'application/json' });
      const url = URL.createObjectURL(dataBlob);
      const link = document.createElement('a');
      link.href = url;
      link.download = `school_data_${new Date().toISOString().split('T')[0]}.json`;
      link.click();
      URL.revokeObjectURL(url);
      showMessage('adminMessage', 'Database downloaded successfully!', 'success');
    }

    function selectCertType(type) {
      document.querySelectorAll('.cert-form').forEach(form => form.classList.add('hidden'));
      document.getElementById(`${type}CertForm`).classList.remove('hidden');
      
      document.querySelectorAll('.cert-type-btn').forEach(btn => {
        btn.classList.remove('ring-4', 'ring-blue-300');
      });
      event.target.closest('.cert-type-btn').classList.add('ring-4', 'ring-blue-300');
    }

    function generateCertId(type) {
      const prefix = {
        'teacher': 'TCH',
        'student': 'STU',
        'committee': 'COM',
        'staff': 'STA'
      }[type];
      
      const timestamp = Date.now().toString().slice(-6);
      const random = Math.floor(Math.random() * 1000).toString().padStart(3, '0');
      const certId = `${prefix}-${timestamp}-${random}`;
      
      document.getElementById(`${type}CertId`).value = certId;
    }

    async function handleCertificateSubmit(e) {
      e.preventDefault();
      
      if (recordCount >= 999) {
        const type = e.target.id.replace('CertificateForm', '');
        showMessage(`${type}CertMessage`, 'Maximum limit of 999 records reached. Please delete some records first.', 'error');
        return;
      }
      
      const formId = e.target.id;
      const type = formId.replace('CertificateForm', '').toLowerCase();
      
      const submitBtn = e.target.querySelector('button[type="submit"]');
      submitBtn.disabled = true;
      submitBtn.textContent = 'Generating...';
      
      const certData = getCertificateData(type);
      
      const result = await window.dataSdk.create(certData);
      
      submitBtn.disabled = false;
      submitBtn.textContent = 'Generate & Save Certificate';
      
      if (result.isOk) {
        showMessage(`${type}CertMessage`, 'Certificate generated and saved successfully!', 'success');
        e.target.reset();
        generateCertId(type);
        // Reset issuer field
        document.getElementById(`${type}CertIssuer`).value = 'Success Systems Brand';
        updateSavedCertificates();
      } else {
        showMessage(`${type}CertMessage`, 'Failed to save certificate. Please try again.', 'error');
      }
    }

    function getCertificateData(type) {
      const baseData = {
        __type: 'certificate',
        id: Date.now().toString(),
        cert_type: type,
        created_at: new Date().toISOString()
      };
      
      switch(type) {
        case 'teacher':
          return {
            ...baseData,
            name: document.getElementById('teacherCertName').value,
            subject: document.getElementById('teacherCertSubject').value,
            achievement: document.getElementById('teacherCertAchievement').value === 'Custom' 
              ? document.getElementById('teacherCertCustom').value 
              : document.getElementById('teacherCertAchievement').value,
            issue_date: document.getElementById('teacherCertDate').value,
            certificate_id: document.getElementById('teacherCertId').value,
            description: document.getElementById('teacherCertDesc').value,
            issued_by: document.getElementById('teacherCertIssuer').value,
            signature: document.getElementById('teacherCertSignature').value
          };
        
        case 'student':
          return {
            ...baseData,
            name: document.getElementById('studentCertName').value,
            grade: document.getElementById('studentCertGrade').value,
            achievement: document.getElementById('studentCertAchievement').value === 'Custom' 
              ? document.getElementById('studentCertCustom').value 
              : document.getElementById('studentCertAchievement').value,
            issue_date: document.getElementById('studentCertDate').value,
            certificate_id: document.getElementById('studentCertId').value,
            description: document.getElementById('studentCertDesc').value,
            issued_by: document.getElementById('studentCertIssuer').value,
            signature: document.getElementById('studentCertSignature').value
          };
        
        case 'committee':
          return {
            ...baseData,
            name: document.getElementById('committeeCertName').value,
            position: document.getElementById('committeeCertPosition').value,
            achievement: document.getElementById('committeeCertAchievement').value === 'Custom' 
              ? document.getElementById('committeeCertCustom').value 
              : document.getElementById('committeeCertAchievement').value,
            service_period: document.getElementById('committeeCertPeriod').value,
            issue_date: document.getElementById('committeeCertDate').value,
            certificate_id: document.getElementById('committeeCertId').value,
            description: document.getElementById('committeeCertDesc').value,
            issued_by: document.getElementById('committeeCertIssuer').value,
            signature: document.getElementById('committeeCertSignature').value
          };
        
        case 'staff':
          return {
            ...baseData,
            name: document.getElementById('staffCertName').value,
            position: document.getElementById('staffCertPosition').value,
            achievement: document.getElementById('staffCertAchievement').value === 'Custom' 
              ? document.getElementById('staffCertCustom').value 
              : document.getElementById('staffCertAchievement').value,
            years_of_service: Number(document.getElementById('staffCertYears').value) || null,
            issue_date: document.getElementById('staffCertDate').value,
            certificate_id: document.getElementById('staffCertId').value,
            description: document.getElementById('staffCertDesc').value,
            issued_by: document.getElementById('staffCertIssuer').value,
            signature: document.getElementById('staffCertSignature').value
          };
      }
    }

    function previewCertificate(type) {
      const certData = {
        name: document.getElementById(`${type}CertName`).value || '[Name]',
        achievement: document.getElementById(`${type}CertAchievement`).value === 'Custom' 
          ? (document.getElementById(`${type}CertCustom`).value || '[Achievement]')
          : (document.getElementById(`${type}CertAchievement`).value || '[Achievement]'),
        issue_date: document.getElementById(`${type}CertDate`).value || new Date().toISOString().split('T')[0],
        certificate_id: document.getElementById(`${type}CertId`).value,
        description: document.getElementById(`${type}CertDesc`).value || '',
        issued_by: document.getElementById(`${type}CertIssuer`).value || 'Success Systems Brand',
        signature: document.getElementById(`${type}CertSignature`).value || '[Signature]'
      };
      
      if (type === 'teacher') {
        certData.subject = document.getElementById('teacherCertSubject').value || '[Subject]';
      } else if (type === 'student') {
        certData.grade = document.getElementById('studentCertGrade').value || '[Grade]';
      } else if (type === 'committee') {
        certData.position = document.getElementById('committeeCertPosition').value || '[Position]';
        certData.service_period = document.getElementById('committeeCertPeriod').value || '[Period]';
      } else if (type === 'staff') {
        certData.position = document.getElementById('staffCertPosition').value || '[Position]';
        certData.years = document.getElementById('staffCertYears').value || '';
      }
      
      renderCertificatePreview(type, certData);
      document.getElementById('certPreviewModal').classList.remove('hidden');
    }

    function renderCertificatePreview(type, data) {
      const content = document.getElementById('certPreviewContent');
      const date = new Date(data.issue_date).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
      
      const typeColors = {
        'teacher': { border: '#2563EB', accent: '#DBEAFE', bg: '#EFF6FF', dark: '#1E40AF' },
        'student': { border: '#10B981', accent: '#D1FAE5', bg: '#ECFDF5', dark: '#047857' },
        'committee': { border: '#7C3AED', accent: '#EDE9FE', bg: '#F5F3FF', dark: '#5B21B6' },
        'staff': { border: '#F59E0B', accent: '#FEF3C7', bg: '#FFFBEB', dark: '#D97706' }
      };
      
      const colors = typeColors[type];
      
      content.innerHTML = `
        <div style="border: 16px solid ${colors.border}; padding: 50px; background: linear-gradient(135deg, #ffffff 0%, ${colors.accent} 50%, ${colors.bg} 100%); min-height: 600px; position: relative; box-shadow: inset 0 0 30px rgba(0,0,0,0.05);">
          <!-- Decorative Corner Ornaments with Islamic Pattern -->
          <div style="position: absolute; top: 30px; left: 30px; width: 100px; height: 100px;">
            <svg width="100" height="100" viewBox="0 0 100 100">
              <circle cx="50" cy="50" r="45" fill="none" stroke="${colors.border}" stroke-width="3"/>
              <circle cx="50" cy="50" r="35" fill="none" stroke="${colors.border}" stroke-width="2"/>
              <circle cx="50" cy="50" r="25" fill="none" stroke="${colors.border}" stroke-width="2"/>
            </svg>
          </div>
          <div style="position: absolute; top: 30px; right: 30px; width: 100px; height: 100px;">
            <svg width="100" height="100" viewBox="0 0 100 100">
              <circle cx="50" cy="50" r="45" fill="none" stroke="${colors.border}" stroke-width="3"/>
              <circle cx="50" cy="50" r="35" fill="none" stroke="${colors.border}" stroke-width="2"/>
              <circle cx="50" cy="50" r="25" fill="none" stroke="${colors.border}" stroke-width="2"/>
            </svg>
          </div>
          <div style="position: absolute; bottom: 30px; left: 30px; width: 100px; height: 100px;">
            <svg width="100" height="100" viewBox="0 0 100 100">
              <circle cx="50" cy="50" r="45" fill="none" stroke="${colors.border}" stroke-width="3"/>
              <circle cx="50" cy="50" r="35" fill="none" stroke="${colors.border}" stroke-width="2"/>
              <circle cx="50" cy="50" r="25" fill="none" stroke="${colors.border}" stroke-width="2"/>
            </svg>
          </div>
          <div style="position: absolute; bottom: 30px; right: 30px; width: 100px; height: 100px;">
            <svg width="100" height="100" viewBox="0 0 100 100">
              <circle cx="50" cy="50" r="45" fill="none" stroke="${colors.border}" stroke-width="3"/>
              <circle cx="50" cy="50" r="35" fill="none" stroke="${colors.border}" stroke-width="2"/>
              <circle cx="50" cy="50" r="25" fill="none" stroke="${colors.border}" stroke-width="2"/>
            </svg>
          </div>
          
          <!-- Decorative Lines -->
          <div style="position: absolute; top: 50%; left: 10px; right: 10px; height: 2px; background: linear-gradient(90deg, transparent, ${colors.border}, transparent); opacity: 0.3; transform: translateY(-50%);"></div>
          
          <div style="text-align: center; position: relative; z-index: 1; font-family: 'Poppins', sans-serif;">
            <!-- School Header -->
            <div style="background: ${colors.border}; color: white; padding: 20px 50px; border-radius: 100px; display: inline-block; margin-bottom: 15px; box-shadow: 0 8px 16px rgba(0,0,0,0.2); position: relative; overflow: hidden;">
              <div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.1) 50%, transparent 70%); animation: shimmer 3s infinite;"></div>
              <div style="font-size: 28px; font-weight: 900; letter-spacing: 3px; text-transform: uppercase; font-family: 'Playfair Display', serif; position: relative; z-index: 1;">
                Madrasa Academy
              </div>
              <div style="font-size: 14px; letter-spacing: 2px; margin-top: 5px; opacity: 0.95; position: relative; z-index: 1;">Management System</div>
            </div>
            
            <div style="font-size: 10px; color: #6B7280; margin-bottom: 5px; font-family: 'Poppins', sans-serif;">Developed By: Umar Ahmed, Hirna Oromia</div>
            
            <div style="font-size: 60px; font-weight: 900; color: ${colors.dark}; margin: 25px 0; font-family: 'Satisfy', cursive; text-shadow: 2px 2px 4px rgba(0,0,0,0.1); letter-spacing: 2px;">
              Certificate
            </div>
            
            <div style="font-size: 22px; color: ${colors.border}; margin-bottom: 35px; font-style: italic; font-family: 'Playfair Display', serif; font-weight: 600;">
              ${type === 'teacher' ? 'of Excellence in Teaching' : 
                type === 'student' ? 'of Outstanding Achievement' : 
                type === 'committee' ? 'of Dedicated Service' : 
                'of Outstanding Performance'}
            </div>
            
            <div style="border: 4px solid ${colors.border}; border-radius: 20px; padding: 35px 25px; margin: 35px auto; max-width: 650px; background: linear-gradient(135deg, rgba(255,255,255,0.95), rgba(255,255,255,0.8)); box-shadow: 0 10px 30px rgba(0,0,0,0.1); position: relative;">
              <!-- Decorative corner elements inside the box -->
              <div style="position: absolute; top: -2px; left: -2px; width: 40px; height: 40px; border-top: 4px solid ${colors.dark}; border-left: 4px solid ${colors.dark};"></div>
              <div style="position: absolute; top: -2px; right: -2px; width: 40px; height: 40px; border-top: 4px solid ${colors.dark}; border-right: 4px solid ${colors.dark};"></div>
              <div style="position: absolute; bottom: -2px; left: -2px; width: 40px; height: 40px; border-bottom: 4px solid ${colors.dark}; border-left: 4px solid ${colors.dark};"></div>
              <div style="position: absolute; bottom: -2px; right: -2px; width: 40px; height: 40px; border-bottom: 4px solid ${colors.dark}; border-right: 4px solid ${colors.dark};"></div>
              
              <div style="font-size: 18px; color: #6B7280; margin-bottom: 18px; font-weight: 500; font-family: 'Poppins', sans-serif;">This certificate is proudly presented to</div>
              <div style="font-size: 42px; font-weight: 900; color: ${colors.dark}; margin: 20px 0; font-family: 'Playfair Display', serif; text-shadow: 1px 1px 2px rgba(0,0,0,0.05);">${data.name}</div>
              ${type === 'teacher' ? `<div style="font-size: 20px; color: #4B5563; margin-top: 12px; font-family: 'Poppins', sans-serif; font-weight: 500;">${data.subject}</div>` : ''}
              ${type === 'student' ? `<div style="font-size: 20px; color: #4B5563; margin-top: 12px; font-family: 'Poppins', sans-serif; font-weight: 500;">Grade: ${data.grade}</div>` : ''}
              ${type === 'committee' ? `<div style="font-size: 20px; color: #4B5563; margin-top: 12px; font-family: 'Poppins', sans-serif; font-weight: 500;">${data.position}</div>` : ''}
              ${type === 'staff' ? `<div style="font-size: 20px; color: #4B5563; margin-top: 12px; font-family: 'Poppins', sans-serif; font-weight: 500;">${data.position}</div>` : ''}
            </div>
            
            <div style="font-size: 18px; color: #6B7280; margin: 25px 0; font-family: 'Poppins', sans-serif; font-weight: 500;">For outstanding achievement in</div>
            <div style="font-size: 28px; font-weight: 800; color: ${colors.border}; margin: 20px 0; font-family: 'Playfair Display', serif; text-shadow: 1px 1px 2px rgba(0,0,0,0.05);">${data.achievement}</div>
            
            ${data.description ? `<div style="font-size: 15px; color: #6B7280; margin: 25px auto; max-width: 550px; line-height: 1.8; font-family: 'Poppins', sans-serif;">${data.description}</div>` : ''}
            ${type === 'committee' && data.service_period ? `<div style="font-size: 18px; color: #4B5563; margin: 18px 0; font-weight: 600; font-family: 'Poppins', sans-serif;">Service Period: ${data.service_period}</div>` : ''}
            ${type === 'staff' && data.years ? `<div style="font-size: 18px; color: #4B5563; margin: 18px 0; font-weight: 600; font-family: 'Poppins', sans-serif;">${data.years} Years of Dedicated Service</div>` : ''}
            
            <div style="margin-top: 50px; display: flex; justify-content: space-around; align-items: end; max-width: 650px; margin-left: auto; margin-right: auto;">
              <div style="text-align: center;">
                <div style="border-bottom: 3px solid ${colors.border}; padding-bottom: 8px; min-width: 220px; margin-bottom: 8px; font-size: 32px; font-family: 'Great Vibes', cursive; color: ${colors.dark};">${data.signature}</div>
                <div style="font-size: 13px; color: #6B7280; text-transform: uppercase; letter-spacing: 1.5px; font-weight: 600; font-family: 'Poppins', sans-serif;">Authorized Signature</div>
              </div>
              <div style="text-align: center;">
                <div style="border-bottom: 3px solid ${colors.border}; padding-bottom: 8px; min-width: 180px; margin-bottom: 8px; font-size: 18px; color: ${colors.dark}; font-weight: 700; font-family: 'Poppins', sans-serif;">${date}</div>
                <div style="font-size: 13px; color: #6B7280; text-transform: uppercase; letter-spacing: 1.5px; font-weight: 600; font-family: 'Poppins', sans-serif;">Date Issued</div>
              </div>
            </div>
            
            <div style="margin-top: 45px; padding-top: 25px; border-top: 2px solid ${colors.border}; font-size: 12px; color: #9CA3AF; letter-spacing: 2px; font-family: 'Poppins', sans-serif;">
              Certificate ID: ${data.certificate_id}
            </div>
            
            <!-- Footer -->
            <div style="margin-top: 35px; padding: 20px; background: linear-gradient(90deg, ${colors.accent}, ${colors.bg}); border-radius: 15px; border: 2px solid ${colors.border};">
              <div style="font-size: 16px; font-weight: 700; color: ${colors.dark}; margin-bottom: 5px; font-family: 'Playfair Display', serif;">Meda Imana Primary School</div>
              <div style="font-size: 12px; color: #6B7280; margin-bottom: 8px; font-family: 'Poppins', sans-serif;">Hirna Town Administration</div>
              <div style="font-size: 10px; color: #9CA3AF; font-family: 'Poppins', sans-serif;">
                Sponsors: <a href="https://t.me/khubeintelligencetechnolgies" style="color: ${colors.border}; text-decoration: underline;">t.me/khubeintelligencetechnolgies</a>
              </div>
            </div>
          </div>
        </div>
      `;
    }

    function closeCertPreview() {
      document.getElementById('certPreviewModal').classList.add('hidden');
    }

    function downloadCertificate() {
      showMessage('adminMessage', 'Certificate download feature available in full version. Certificate has been saved to your data.', 'info');
      setTimeout(() => {
        closeCertPreview();
      }, 2000);
    }

    function updateSavedCertificates() {
      const certificates = allRecords.filter(r => r.__type === 'certificate');
      const container = document.getElementById('savedCertificates');
      
      if (certificates.length === 0) {
        container.innerHTML = '<p class="text-gray-500 text-sm">No certificates saved yet</p>';
        return;
      }
      
      container.innerHTML = certificates.map(cert => {
        const typeEmoji = {
          'teacher': 'üë®‚Äçüè´',
          'student': 'üéì',
          'committee': 'ü§ù',
          'staff': 'üíº'
        }[cert.cert_type];
        
        const typeColor = {
          'teacher': 'bg-blue-50 border-blue-200',
          'student': 'bg-green-50 border-green-200',
          'committee': 'bg-purple-50 border-purple-200',
          'staff': 'bg-yellow-50 border-yellow-200'
        }[cert.cert_type];
        
        return `
          <div class="flex items-center justify-between ${typeColor} border-2 p-4 rounded-lg">
            <div class="flex items-center space-x-3">
              <div class="text-3xl">${typeEmoji}</div>
              <div>
                <div class="font-bold text-gray-800">${cert.name}</div>
                <div class="text-sm text-gray-600">${cert.achievement} - ${cert.certificate_id}</div>
                <div class="text-xs text-gray-500">${new Date(cert.issue_date).toLocaleDateString()}</div>
              </div>
            </div>
            <div class="flex space-x-2">
              <button onclick="viewSavedCertificate('${cert.__backendId}')" class="bg-blue-500 text-white px-3 py-1 rounded text-sm hover:bg-blue-600">
                View
              </button>
              <button onclick="deleteCertificate('${cert.__backendId}')" class="bg-red-500 text-white px-3 py-1 rounded text-sm hover:bg-red-600">
                Delete
              </button>
            </div>
          </div>
        `;
      }).join('');
    }

    function viewSavedCertificate(backendId) {
      const cert = allRecords.find(r => r.__backendId === backendId);
      if (!cert) return;
      
      renderCertificatePreview(cert.cert_type, cert);
      document.getElementById('certPreviewModal').classList.remove('hidden');
    }

    async function deleteCertificate(backendId) {
      const cert = allRecords.find(r => r.__backendId === backendId);
      if (!cert) return;
      
      const result = await window.dataSdk.delete(cert);
      
      if (result.isOk) {
        showMessage('adminMessage', 'Certificate deleted successfully!', 'success');
        updateSavedCertificates();
      } else {
        showMessage('adminMessage', 'Failed to delete certificate.', 'error');
      }
    }

    function downloadDatabase() {
      const dataStr = JSON.stringify(allRecords, null, 2);
      const dataBlob = new Blob([dataStr], { type: 'application/json' });
      const url = URL.createObjectURL(dataBlob);
      const link = document.createElement('a');
      link.href = url;
      link.download = `school_data_${new Date().toISOString().split('T')[0]}.json`;
      link.click();
      URL.revokeObjectURL(url);
      showMessage('adminMessage', 'Database downloaded successfully!', 'success');
    }

    function showUploadLogo() {
      showMessage('adminMessage', 'Logo upload feature available in full version', 'info');
    }

    function showSystemSettings() {
      showMessage('adminMessage', 'System settings coming soon!', 'info');
    }

    function showMessage(elementId, message, type) {
      const el = document.getElementById(elementId);
      el.textContent = message;
      el.className = type === 'success' ? 'text-green-600 text-sm' : type === 'info' ? 'text-blue-600 text-sm' : 'text-red-600 text-sm';
      el.classList.remove('hidden');
      setTimeout(() => el.classList.add('hidden'), 5000);
    }

    // Excel Export Functions
    function exportAttendanceToExcel() {
      const attendance = allRecords.filter(r => r.__type === 'attendance');
      if (attendance.length === 0) {
        showMessage('attMessage', 'No attendance records to export', 'error');
        return;
      }
      
      const csv = convertToCSV(attendance, [
        { key: 'person_type', label: 'Person Type' },
        { key: 'name', label: 'Name' },
        { key: 'date', label: 'Date' },
        { key: 'time_in', label: 'Time In' },
        { key: 'time_out', label: 'Time Out' },
        { key: 'status', label: 'Status' },
        { key: 'hours_worked', label: 'Hours Worked' },
        { key: 'notes', label: 'Notes' }
      ]);
      
      downloadCSV(csv, `Attendance_Report_${new Date().toISOString().split('T')[0]}.csv`);
      showMessage('attMessage', 'Attendance report exported successfully!', 'success');
    }

    function exportRallyToExcel() {
      const rally = allRecords.filter(r => r.__type === 'student_rally');
      if (rally.length === 0) {
        showMessage('rallyMessage', 'No rally records to export', 'error');
        return;
      }
      
      const csv = convertToCSV(rally, [
        { key: 'row_number', label: 'Row #' },
        { key: 'teacher_name', label: 'Teacher Name' },
        { key: 'date', label: 'Date' },
        { key: 'issue_not_attended_rally', label: 'Not Attended Rally' },
        { key: 'issue_no_gown', label: 'No Gown' },
        { key: 'issue_student_protection', label: 'Student Protection Issue' },
        { key: 'issue_discipline_violated', label: 'Discipline Violated' },
        { key: 'issue_no_circle', label: 'No Circle' },
        { key: 'issue_no_garden', label: 'No Garden' },
        { key: 'issue_no_weekly_plan', label: 'No Weekly Plan' },
        { key: 'issue_no_monthly_plan', label: 'No Monthly Plan' },
        { key: 'issue_no_assembly', label: 'No Assembly' },
        { key: 'issue_no_yearly_plan', label: 'No Yearly Plan' },
        { key: 'issue_no_grade_improvement', label: 'No Grade Improvement' },
        { key: 'additional_notes', label: 'Notes' },
        { key: 'supervisor_signature', label: 'Supervisor' }
      ]);
      
      downloadCSV(csv, `Student_Rally_Report_${new Date().toISOString().split('T')[0]}.csv`);
      showMessage('rallyMessage', 'Rally report exported successfully!', 'success');
      updateRallyRecordsList();
    }

    function exportMissedPeriodsToExcel() {
      const missed = allRecords.filter(r => r.__type === 'missed_periods');
      if (missed.length === 0) {
        showMessage('sectorsMessage', 'No missed periods to export', 'error');
        return;
      }
      
      const csv = convertToCSV(missed, [
        { key: 'row_number', label: 'Row #' },
        { key: 'teacher_name', label: 'Teacher Name' },
        { key: 'day', label: 'Date' },
        { key: 'period1_subject', label: 'Period 1 Subject' },
        { key: 'period1_grade', label: 'Period 1 Grade' },
        { key: 'period1_minutes', label: 'Period 1 Minutes' },
        { key: 'period2_subject', label: 'Period 2 Subject' },
        { key: 'period2_grade', label: 'Period 2 Grade' },
        { key: 'period2_minutes', label: 'Period 2 Minutes' },
        { key: 'period3_subject', label: 'Period 3 Subject' },
        { key: 'period3_grade', label: 'Period 3 Grade' },
        { key: 'period3_minutes', label: 'Period 3 Minutes' },
        { key: 'period4_subject', label: 'Period 4 Subject' },
        { key: 'period4_grade', label: 'Period 4 Grade' },
        { key: 'period4_minutes', label: 'Period 4 Minutes' },
        { key: 'reason', label: 'Reason' },
        { key: 'teacher_signature', label: 'Signature' }
      ]);
      
      downloadCSV(csv, `Missed_Periods_Report_${new Date().toISOString().split('T')[0]}.csv`);
      showMessage('sectorsMessage', 'Missed periods report exported successfully!', 'success');
    }

    function exportReportCardsToExcel() {
      const reports = allRecords.filter(r => r.__type === 'report_card');
      if (reports.length === 0) {
        showMessage('reportCardMessage', 'No report cards to export', 'error');
        return;
      }
      
      const csv = convertToCSV(reports, [
        { key: 'student_name', label: 'Student Name' },
        { key: 'grade', label: 'Grade' },
        { key: 'section', label: 'Section' },
        { key: 'semester', label: 'Semester' },
        { key: 'academic_year', label: 'Academic Year' },
        { key: 'mathematics', label: 'Mathematics' },
        { key: 'english', label: 'English' },
        { key: 'amharic', label: 'Amharic' },
        { key: 'afaan_oromo', label: 'Afaan Oromo' },
        { key: 'science', label: 'Science' },
        { key: 'social_studies', label: 'Social Studies' },
        { key: 'physical_education', label: 'Physical Education' },
        { key: 'art', label: 'Art' },
        { key: 'quran', label: 'Quran' },
        { key: 'arabic', label: 'Arabic' },
        { key: 'tarbiya', label: 'Tarbiya' },
        { key: 'anashid', label: 'Anashid' },
        { key: 'total_marks', label: 'Total Marks' },
        { key: 'average', label: 'Average' },
        { key: 'class_rank', label: 'Rank' },
        { key: 'conduct', label: 'Conduct' },
        { key: 'attendance', label: 'Attendance' },
        { key: 'teacher_comment', label: 'Teacher Comment' }
      ]);
      
      downloadCSV(csv, `Report_Cards_${new Date().toISOString().split('T')[0]}.csv`);
      showMessage('reportCardMessage', 'Report cards exported successfully!', 'success');
    }

    function exportAllDataToExcel() {
      const csv = convertToCSV(allRecords, [
        { key: '__type', label: 'Record Type' },
        { key: 'id', label: 'ID' },
        { key: 'created_at', label: 'Created Date' }
      ]);
      
      downloadCSV(csv, `Complete_School_Data_${new Date().toISOString().split('T')[0]}.csv`);
      showMessage('adminMessage', 'Complete data export successful!', 'success');
    }

    function convertToCSV(data, columns) {
      if (data.length === 0) return '';
      
      // Header row with Success Systems Brand branding
      const brandHeader = `Success Systems Brand - School Management System\nGenerated: ${new Date().toLocaleString()}\n\n`;
      
      // Column headers
      const headers = columns.map(col => `"${col.label}"`).join(',');
      
      // Data rows
      const rows = data.map(record => {
        return columns.map(col => {
          let value = record[col.key];
          
          // Handle boolean values
          if (typeof value === 'boolean') {
            value = value ? 'Yes' : 'No';
          }
          
          // Handle null/undefined
          if (value === null || value === undefined) {
            value = '';
          }
          
          // Escape quotes and wrap in quotes
          value = String(value).replace(/"/g, '""');
          return `"${value}"`;
        }).join(',');
      }).join('\n');
      
      return brandHeader + headers + '\n' + rows;
    }

    function downloadCSV(csv, filename) {
      const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
      const link = document.createElement('a');
      const url = URL.createObjectURL(blob);
      link.setAttribute('href', url);
      link.setAttribute('download', filename);
      link.style.visibility = 'hidden';
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      URL.revokeObjectURL(url);
    }

    function updateRallyRecordsList() {
      const rally = allRecords.filter(r => r.__type === 'student_rally').slice(-5);
      const container = document.getElementById('savedRallyRecords');
      
      if (rally.length === 0) {
        container.innerHTML = '<p class="text-gray-500 text-sm">No rally records saved yet</p>';
        return;
      }
      
      container.innerHTML = rally.reverse().map(r => `
        <div class="bg-white p-4 rounded-lg border-2 border-blue-300 shadow-sm hover:shadow-md transition-shadow">
          <div class="flex justify-between items-start">
            <div>
              <div class="font-bold text-gray-800">Row #${r.row_number} - ${r.teacher_name}</div>
              <div class="text-sm text-gray-600">${new Date(r.date).toLocaleDateString()}</div>
              <div class="text-xs text-gray-500 mt-1">
                Issues: ${[r.issue_not_attended_rally, r.issue_no_gown, r.issue_student_protection, 
                  r.issue_discipline_violated, r.issue_no_circle, r.issue_no_garden].filter(Boolean).length} found
              </div>
            </div>
            <button onclick="deleteRallyRecord('${r.__backendId}')" class="bg-red-500 text-white px-3 py-1 rounded text-sm hover:bg-red-600">
              Delete
            </button>
          </div>
        </div>
      `).join('');
    }

    async function deleteRallyRecord(backendId) {
      const record = allRecords.find(r => r.__backendId === backendId);
      if (!record) return;
      
      const result = await window.dataSdk.delete(record);
      
      if (result.isOk) {
        updateRallyRecordsList();
      }
    }

    initApp();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9b2c354211428a61',t:'MTc2NjUzODUxMi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>